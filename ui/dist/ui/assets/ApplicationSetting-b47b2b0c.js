import{cp as Xe,d1 as Ye,dt as xe,cZ as h,cq as r,d3 as el,ct as ll,cu as s,cU as al,cx as d,cF as u,cA as o,cB as i,cJ as p,cz as t,cK as _,cv as B,cy as V,cN as g,cE as re,cC as tl,cD as ol,cH as F,dn as T,dp as il,dq as nl,dr as sl,cw as ue,dy as pl,dh as dl,cQ as N,cT as O,cR as rl}from"./index-1a322249.js";import{_ as ul,b as ml,c as cl,d as _l,a as vl}from"./ReasoningParamSettingDialog.vue_vue_type_script_setup_true_lang-2680ab56.js";import{_ as fl}from"./EditAvatarDialog.vue_vue_type_script_setup_true_lang-f55d8e57.js";const gl={class:"flex-between w-full"},bl={class:"p-24 mb-16",style:{"padding-bottom":"0"}},yl={class:"title-decoration-1"},hl={class:"scrollbar-height-left"},wl={class:"flex-between"},$l={class:"flex-between"},Fl={class:"flex align-center"},Sl={class:"mr-4"},kl={key:0,class:"danger ml-4"},Vl={class:"flex-between"},Dl={class:"w-full"},Rl={class:"flex-between"},Ml={class:"flex align-center",style:{width:"80%"}},Tl=["title"],Pl={class:"flex align-center"},ql={class:"mr-4"},Cl={key:0,class:"danger ml-4"},Al={class:"flex-between"},Ul={class:"mr-4"},El={class:"flex"},Il={class:"flex-between"},zl={class:"mr-4"},Bl={key:0,class:"danger"},Nl={class:"flex"},Ol={class:"flex-between"},Ll={class:"mr-4"},Kl={key:0,class:"danger"},Gl={class:"flex"},Wl={class:"w-full"},jl={class:"flex-between w-full"},Hl={class:"title-decoration-1 mb-16"},Jl={class:"dialog-bg"},Ql={class:"flex align-center p-16 mb-8"},Zl=["src"],Xl={class:"scrollbar-height"},Yl=Xe({__name:"ApplicationSetting",setup(xl){const{model:ea,application:D}=Ye(),me=xe(),{params:{id:v}}=me,L=h("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),ce=h("views.application.applicationForm.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+h("views.application.applicationForm.dialog.defaultPrompt2"),P=r(),K=r(),q=r(),G=r(),W=r(),j=r(),H=r(),m=r(!1),J=r(!1),l=r({name:"",desc:"",model_id:"",dialogue_number:1,prologue:h("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:L,system:h("views.application.applicationForm.form.roleSettings.placeholder"),no_references_prompt:"{question}",reasoning_content_enable:!1},model_params_setting:{},problem_optimization:!1,problem_optimization_prompt:ce,stt_model_id:"",tts_model_id:"",stt_model_enable:!1,tts_model_enable:!1,tts_type:"BROWSER",type:"SIMPLE"}),_e=el({name:[{required:!0,message:h("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]}),Q=r(null),w=r([]),Z=r(null),X=r(null),C=r(!1);function ve(e){l.value.prologue=e}function fe(e){l.value.model_setting.prompt=e}function ge(e){l.value.model_setting.no_references_prompt=e}function be(e){l.value.model_setting.system=e}function ye(e){l.value.model_setting={...l.value.model_setting,...e}}const he=async e=>{e&&await e.validate((a,b)=>{a&&D.asyncPutApplication(v,l.value,m).then(A=>{dl(h("common.saveSuccess"))})})},we=e=>{var a;l.value.model_id=e,e?(a=P.value)==null||a.reset_default(e,v):Y({})},$e=()=>{var e;l.value.model_id&&((e=P.value)==null||e.open(l.value.model_id,v,l.value.model_params_setting))},Fe=()=>{var e;(e=K.value)==null||e.open(l.value.model_setting)},Se=()=>{var e;l.value.tts_model_id&&((e=q.value)==null||e.open(l.value.tts_model_id,v,l.value.tts_model_params_setting))},ke=()=>{var e;(e=G.value)==null||e.open(l.value)};function Ve(e){l.value={...l.value,...e}}function Y(e){l.value.model_params_setting=e}function x(e){l.value.tts_model_params_setting=e}function De(e){l.value.dataset_id_list&&l.value.dataset_id_list.splice(l.value.dataset_id_list.indexOf(e),1)}function Re(e){l.value.dataset_id_list=e}function Me(){j.value.open(l.value.dataset_id_list)}function ee(){D.asyncGetApplicationDetail(v,m).then(e=>{l.value=e.data,l.value.model_id=e.data.model,l.value.stt_model_id=e.data.stt_model,l.value.tts_model_id=e.data.tts_model,l.value.tts_type=e.data.tts_type,l.value.model_setting.no_references_prompt=e.data.model_setting.no_references_prompt||"{question}",D.asyncGetAccessToken(v,m).then(a=>{l.value={...l.value,...a.data}})})}function le(){D.asyncGetApplicationDataset(v,J).then(e=>{w.value=e.data})}function ae(){m.value=!0,N.getApplicationModel(v).then(e=>{Q.value=O.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Te(){m.value=!0,N.getApplicationSTTModel(v).then(e=>{Z.value=O.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Pe(){m.value=!0,N.getApplicationTTSModel(v).then(e=>{X.value=O.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function qe(){var e;l.value.tts_model_id?(e=q.value)==null||e.reset_default(l.value.tts_model_id,v):x({})}function Ce(){l.value.tts_model_enable||(l.value.tts_model_id="",l.value.tts_type="BROWSER")}function te(){l.value.stt_model_enable||(l.value.stt_model_id="")}function Ae(){H.value.open(l.value)}function Ue(){ee()}function Ee(){le()}return ll(()=>{ae(),le(),ee(),Te(),Pe()}),(e,a)=>{const b=s("el-button"),A=s("el-input"),c=s("el-form-item"),U=s("ModelSelect"),R=s("MdEditorMagnify"),E=s("AppIcon"),oe=s("el-tooltip"),Ie=s("el-input-number"),ze=s("Plus"),S=s("el-icon"),Be=s("el-text"),$=s("AppAvatar"),Ne=s("Close"),Oe=s("el-card"),I=s("el-col"),ie=s("el-row"),Le=s("Setting"),z=s("el-switch"),ne=s("el-checkbox"),se=s("el-radio"),Ke=s("el-radio-group"),Ge=s("Operation"),We=s("el-form"),je=s("el-scrollbar"),He=s("EditPen"),Je=s("AiChat"),Qe=s("LayoutContainer"),Ze=al("loading");return d(),u(Qe,{class:"create-application"},{header:o(()=>[i("div",gl,[i("h3",null,p(e.$t("common.setting")),1),t(b,{type:"primary",onClick:a[0]||(a[0]=n=>he(W.value)),disabled:m.value},{default:o(()=>[_(p(e.$t("views.application.applicationForm.buttons.publish")),1)]),_:1},8,["disabled"])])]),default:o(()=>[B((d(),u(ie,null,{default:o(()=>[t(I,{span:10},{default:o(()=>[i("div",bl,[i("h4",yl,p(e.$t("views.applicationOverview.appInfo.header")),1)]),i("div",hl,[t(je,null,{default:o(()=>[t(We,{"hide-required-asterisk":"",ref_key:"applicationFormRef",ref:W,model:l.value,rules:_e,"label-position":"top","require-asterisk-position":"right",class:"p-24",style:{"padding-top":"0"}},{default:o(()=>[t(c,{prop:"name"},{label:o(()=>[i("div",wl,[i("span",null,[_(p(e.$t("views.application.applicationForm.form.appName.label"))+" ",1),a[23]||(a[23]=i("span",{class:"danger"},"*",-1))])])]),default:o(()=>[t(A,{modelValue:l.value.name,"onUpdate:modelValue":a[1]||(a[1]=n=>l.value.name=n),maxlength:"64",placeholder:e.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":"",onBlur:a[2]||(a[2]=n=>{var f;return l.value.name=(f=l.value.name)==null?void 0:f.trim()})},null,8,["modelValue","placeholder"])]),_:1}),t(c,{label:e.$t("views.application.applicationForm.form.appDescription.label")},{default:o(()=>[t(A,{modelValue:l.value.desc,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value.desc=n),type:"textarea",placeholder:e.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:e.$t("views.application.applicationForm.form.aiModel.label")},{label:o(()=>[i("div",$l,[i("span",null,p(e.$t("views.application.applicationForm.form.aiModel.label")),1),t(b,{type:"primary",link:"",onClick:$e,disabled:!l.value.model_id},{default:o(()=>[_(p(e.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:o(()=>[t(U,{modelValue:l.value.model_id,"onUpdate:modelValue":a[4]||(a[4]=n=>l.value.model_id=n),placeholder:e.$t("views.application.applicationForm.form.aiModel.placeholder"),options:Q.value,onChange:we,onSubmitModel:ae,showFooter:"","model-type":"LLM"},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),t(c,{label:e.$t("views.application.applicationForm.form.roleSettings.label")},{default:o(()=>[t(R,{title:e.$t("views.application.applicationForm.form.roleSettings.label"),modelValue:l.value.model_setting.system,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.model_setting.system=n),style:{height:"120px"},onSubmitDialog:be,placeholder:e.$t("views.application.applicationForm.form.roleSettings.placeholder")},null,8,["title","modelValue","placeholder"])]),_:1},8,["label"]),t(c,{prop:"model_setting.no_references_prompt",rules:{required:l.value.model_id,message:e.$t("views.application.applicationForm.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[i("div",Fl,[i("span",Sl,p(e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.noReferences")),1),t(oe,{effect:"dark",content:e.$t("views.application.applicationForm.form.prompt.noReferencesTooltip",{question:"{question}"}),placement:"right","popper-class":"max-w-350"},{default:o(()=>[t(E,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.model_id?(d(),V("span",kl,"*")):g("",!0)])]),default:o(()=>[t(R,{title:e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.noReferences"),modelValue:l.value.model_setting.no_references_prompt,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.model_setting.no_references_prompt=n),style:{height:"120px"},onSubmitDialog:ge,placeholder:"{question}"},null,8,["title","modelValue"])]),_:1},8,["rules"]),t(c,{label:e.$t("views.application.applicationForm.form.historyRecord.label"),onClick:a[8]||(a[8]=re(()=>{},["prevent"]))},{default:o(()=>[t(Ie,{modelValue:l.value.dialogue_number,"onUpdate:modelValue":a[7]||(a[7]=n=>l.value.dialogue_number=n),min:0,"value-on-clear":0,"controls-position":"right",class:"w-full",step:1,"step-strictly":!0},null,8,["modelValue"])]),_:1},8,["label"]),t(c,{label:"$t('views.application.applicationForm.form.relatedKnowledgeBase')"},{label:o(()=>[i("div",Vl,[i("span",null,p(e.$t("views.application.applicationForm.form.relatedKnowledge.label")),1),i("div",null,[t(b,{type:"primary",link:"",onClick:ke},{default:o(()=>[t(E,{iconName:"app-operation",class:"mr-4"}),_(" "+p(e.$t("common.paramSetting")),1)]),_:1}),t(b,{type:"primary",link:"",onClick:Me},{default:o(()=>[t(S,{class:"mr-4"},{default:o(()=>[t(ze)]),_:1}),_(" "+p(e.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var n;return[i("div",Dl,[((n=l.value.dataset_id_list)==null?void 0:n.length)===0?(d(),u(Be,{key:0,type:"info"},{default:o(()=>[_(p(e.$t("views.application.applicationForm.form.relatedKnowledge.placeholder")),1)]),_:1})):(d(),u(ie,{key:1,gutter:12},{default:o(()=>[(d(!0),V(tl,null,ol(l.value.dataset_id_list,(f,M)=>(d(),u(I,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:M},{default:o(()=>[t(Oe,{class:"relate-dataset-card border-r-4",shadow:"never"},{default:o(()=>{var k,y,pe,de;return[i("div",Rl,[i("div",Ml,[((k=F(T)(w.value,f,"id"))==null?void 0:k.type)==="1"?(d(),u($,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:o(()=>a[24]||(a[24]=[i("img",{src:il,style:{width:"58%"},alt:""},null,-1)])),_:1})):((y=F(T)(w.value,f,"id"))==null?void 0:y.type)==="2"?(d(),u($,{key:1,class:"mr-8 avatar-purple",shape:"square",size:32,style:{background:"none"}},{default:o(()=>a[25]||(a[25]=[i("img",{src:nl,style:{width:"100%"},alt:""},null,-1)])),_:1})):(d(),u($,{key:2,class:"mr-8 avatar-blue",shape:"square",size:32},{default:o(()=>a[26]||(a[26]=[i("img",{src:sl,style:{width:"58%"},alt:""},null,-1)])),_:1})),i("span",{class:"ellipsis cursor",title:(pe=F(T)(w.value,f,"id"))==null?void 0:pe.name},p((de=F(T)(w.value,f,"id"))==null?void 0:de.name),9,Tl)]),t(b,{text:"",onClick:la=>De(f)},{default:o(()=>[t(S,null,{default:o(()=>[t(Ne)]),_:1})]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))])]}),_:1}),t(c,{label:e.$t("views.application.applicationForm.form.prompt.label"),prop:"model_setting.prompt",rules:{required:l.value.model_id,message:e.$t("views.application.applicationForm.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[i("div",Pl,[i("span",ql,p(e.$t("views.application.applicationForm.form.prompt.label"))+" "+p(e.$t("views.application.applicationForm.form.prompt.references")),1),t(oe,{effect:"dark",content:e.$t("views.application.applicationForm.form.prompt.referencesTooltip",{data:"{data}",question:"{question}"}),"popper-class":"max-w-350",placement:"right"},{default:o(()=>[t(E,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.model_id?(d(),V("span",Cl,"*")):g("",!0)])]),default:o(()=>[t(R,{title:e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.references"),modelValue:l.value.model_setting.prompt,"onUpdate:modelValue":a[9]||(a[9]=n=>l.value.model_setting.prompt=n),style:{height:"150px"},onSubmitDialog:fe,placeholder:F(L)},null,8,["title","modelValue","placeholder"])]),_:1},8,["label","rules"]),t(c,{label:e.$t("views.application.applicationForm.form.prologue")},{default:o(()=>[t(R,{title:e.$t("views.application.applicationForm.form.prologue"),modelValue:l.value.prologue,"onUpdate:modelValue":a[10]||(a[10]=n=>l.value.prologue=n),style:{height:"150px"},onSubmitDialog:ve},null,8,["title","modelValue"])]),_:1},8,["label"]),t(c,{onClick:a[12]||(a[12]=re(()=>{},["prevent"]))},{label:o(()=>[i("div",Al,[i("span",Ul,p(e.$t("views.application.applicationForm.form.reasoningContent.label")),1),i("div",El,[t(b,{type:"primary",link:"",onClick:Fe},{default:o(()=>[t(S,null,{default:o(()=>[t(Le)]),_:1})]),_:1}),t(z,{class:"ml-8",size:"small",modelValue:l.value.model_setting.reasoning_content_enable,"onUpdate:modelValue":a[11]||(a[11]=n=>l.value.model_setting.reasoning_content_enable=n),onChange:te},null,8,["modelValue"])])])]),_:1}),t(c,{prop:"stt_model_id",rules:{required:l.value.stt_model_enable,message:e.$t("views.application.applicationForm.form.voiceInput.requiredMessage"),trigger:"change"}},{label:o(()=>[i("div",Il,[i("span",zl,[_(p(e.$t("views.application.applicationForm.form.voiceInput.label"))+" ",1),l.value.stt_model_enable?(d(),V("span",Bl,"*")):g("",!0)]),i("div",Nl,[l.value.stt_model_enable?(d(),u(ne,{key:0,modelValue:l.value.stt_autosend,"onUpdate:modelValue":a[13]||(a[13]=n=>l.value.stt_autosend=n)},{default:o(()=>[_(p(e.$t("views.application.applicationForm.form.voiceInput.autoSend")),1)]),_:1},8,["modelValue"])):g("",!0),t(z,{class:"ml-8",size:"small",modelValue:l.value.stt_model_enable,"onUpdate:modelValue":a[14]||(a[14]=n=>l.value.stt_model_enable=n),onChange:te},null,8,["modelValue"])])])]),default:o(()=>[B(t(U,{modelValue:l.value.stt_model_id,"onUpdate:modelValue":a[15]||(a[15]=n=>l.value.stt_model_id=n),placeholder:e.$t("views.application.applicationForm.form.voiceInput.placeholder"),options:Z.value,"model-type":"STT"},null,8,["modelValue","placeholder","options"]),[[ue,l.value.stt_model_enable]])]),_:1},8,["rules"]),t(c,{prop:"tts_model_id",rules:{required:l.value.tts_type==="TTS"&&l.value.tts_model_enable,message:e.$t("views.application.applicationForm.form.voicePlay.requiredMessage"),trigger:"change"}},{label:o(()=>[i("div",Ol,[i("span",Ll,[_(p(e.$t("views.application.applicationForm.form.voicePlay.label"))+" ",1),l.value.tts_type==="TTS"&&l.value.tts_model_enable?(d(),V("span",Kl,"*")):g("",!0)]),i("div",Gl,[l.value.tts_model_enable?(d(),u(ne,{key:0,modelValue:l.value.tts_autoplay,"onUpdate:modelValue":a[16]||(a[16]=n=>l.value.tts_autoplay=n)},{default:o(()=>[_(p(e.$t("views.application.applicationForm.form.voicePlay.autoPlay")),1)]),_:1},8,["modelValue"])):g("",!0),t(z,{class:"ml-8",size:"small",modelValue:l.value.tts_model_enable,"onUpdate:modelValue":a[17]||(a[17]=n=>l.value.tts_model_enable=n),onChange:Ce},null,8,["modelValue"])])])]),default:o(()=>[i("div",Wl,[B(t(Ke,{modelValue:l.value.tts_type,"onUpdate:modelValue":a[18]||(a[18]=n=>l.value.tts_type=n),class:"mb-8"},{default:o(()=>[t(se,{value:"BROWSER"},{default:o(()=>[_(p(e.$t("views.application.applicationForm.form.voicePlay.browser")),1)]),_:1}),t(se,{value:"TTS"},{default:o(()=>[_(p(e.$t("views.application.applicationForm.form.voicePlay.tts")),1)]),_:1})]),_:1},8,["modelValue"]),[[ue,l.value.tts_model_enable]])]),i("div",jl,[l.value.tts_type==="TTS"&&l.value.tts_model_enable?(d(),u(U,{key:0,modelValue:l.value.tts_model_id,"onUpdate:modelValue":a[19]||(a[19]=n=>l.value.tts_model_id=n),placeholder:e.$t("views.application.applicationForm.form.voicePlay.placeholder"),options:X.value,onChange:a[20]||(a[20]=n=>qe()),"model-type":"TTS"},null,8,["modelValue","placeholder","options"])):g("",!0),l.value.tts_type==="TTS"?(d(),u(b,{key:1,onClick:Se,disabled:!l.value.tts_model_id,class:"ml-8"},{default:o(()=>[t(S,null,{default:o(()=>[t(Ge)]),_:1})]),_:1},8,["disabled"])):g("",!0)])]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})])]),_:1}),t(I,{span:14,class:"p-24 border-l"},{default:o(()=>{var n,f,M,k;return[i("h4",Hl,p(e.$t("views.application.applicationForm.title.appTest")),1),i("div",Jl,[i("div",Ql,[i("div",{class:"edit-avatar mr-12",onMouseenter:a[21]||(a[21]=y=>C.value=!0),onMouseleave:a[22]||(a[22]=y=>C.value=!1)},[F(pl)((n=l.value)==null?void 0:n.icon)?(d(),u($,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var y;return[i("img",{src:(y=l.value)==null?void 0:y.icon,alt:""},null,8,Zl)]}),_:1})):(f=l.value)!=null&&f.name?(d(),u($,{key:1,name:(M=l.value)==null?void 0:M.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):g("",!0),C.value?(d(),u($,{key:2,shape:"square",class:"edit-mask",size:32,onClick:Ae},{default:o(()=>[t(S,null,{default:o(()=>[t(He)]),_:1})]),_:1})):g("",!0)],32),i("h4",null,p(((k=l.value)==null?void 0:k.name)||e.$t("views.application.applicationForm.form.appName.label")),1)]),i("div",Xl,[t(Je,{applicationDetails:l.value,type:"debug-ai-chat"},null,8,["applicationDetails"])])])]}),_:1})]),_:1})),[[Ze,m.value]]),t(ul,{ref_key:"AIModeParamSettingDialogRef",ref:P,onRefresh:Y},null,512),t(ml,{ref_key:"TTSModeParamSettingDialogRef",ref:q,onRefresh:x},null,512),t(cl,{ref_key:"ParamSettingDialogRef",ref:G,onRefresh:Ve},null,512),t(_l,{ref_key:"AddDatasetDialogRef",ref:j,onAddData:Re,data:w.value,onRefresh:Ee,loading:J.value},null,8,["data","loading"]),t(fl,{ref_key:"EditAvatarDialogRef",ref:H,onRefresh:Ue},null,512),t(vl,{ref_key:"ReasoningParamSettingDialogRef",ref:K,onRefresh:ye},null,512)]),_:1})}}});const ia=rl(Yl,[["__scopeId","data-v-d9124be2"]]);export{ia as default};
