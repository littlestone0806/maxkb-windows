import{dS as K,dT as me,eB as ce,dU as pe,cp as R,cq as p,cZ as U,d0 as Z,ct as Q,cu as r,cx as y,cF as V,cA as o,cB as d,cV as _e,cJ as $,cz as s,cE as B,cK as D,dh as H,cR as W,cr as P,cy as O,dr as ve,cN as q,cH as M,cC as X,d3 as fe,cU as be,cv as J,cD as ge,c_ as he}from"./index-1a322249.js";const L="/team/member",Ae=()=>K(`${L}`),Me=m=>me(`${L}/_batch`,m),ye=m=>ce(`${L}/${m}`),Ce=m=>K(`${L}/${m}`),$e=(m,T)=>pe(`${L}/${m}`,T),I={getTeamMember:Ae,postCreatTeamMember:Me,delTeamMember:ye,getMemberPermissions:Ce,putMemberPermissions:$e},Ee=["id"],Se={class:"dialog-sub-title"},ke={class:"dialog-footer"},Ne=R({__name:"CreateMemberDialog",emits:["refresh"],setup(m,{expose:T,emit:_}){const E=_,v=p(!1),f=p({users:[]}),h=p(),u=p(!1),w=p({users:[{type:"array",required:!0,message:U("views.team.teamForm.form.userName.requiredMessage"),trigger:"change"}]});Z(v,e=>{e||(f.value={users:[]},u.value=!1)});const G=()=>{v.value=!0},n=async e=>{e&&await e.validate((i,A)=>{if(i){u.value=!0;let S=f.value.users.map(k=>k.id);I.postCreatTeamMember(S).then(k=>{H(U("common.submitSuccess")),E("refresh",S),v.value=!1,u.value=!1}).catch(()=>{u.value=!1})}})};return Q(()=>{}),T({open:G,close}),(e,i)=>{const A=r("tags-input"),S=r("el-form-item"),k=r("el-form"),N=r("el-button"),x=r("el-dialog");return y(),V(x,{modelValue:v.value,"onUpdate:modelValue":i[4]||(i[4]=t=>v.value=t),"close-on-press-escape":!1,"close-on-click-modal":!1,"destroy-on-close":!0,width:"600",class:"member-dialog"},{header:o(({titleId:t,titleClass:C})=>[d("h4",{id:t,class:_e(C)},$(e.$t("views.team.addMember")),11,Ee),d("div",Se,$(e.$t("views.team.addSubTitle")),1)]),footer:o(()=>[d("span",ke,[s(N,{onClick:i[2]||(i[2]=B(t=>v.value=!1,["prevent"]))},{default:o(()=>[D($(e.$t("common.cancel")),1)]),_:1}),s(N,{type:"primary",onClick:i[3]||(i[3]=t=>n(h.value)),loading:u.value},{default:o(()=>[D($(e.$t("common.add")),1)]),_:1},8,["loading"])])]),default:o(()=>[s(k,{ref_key:"addMemberFormRef",ref:h,model:f.value,"label-position":"top",rules:w.value,"require-asterisk-position":"right",onSubmit:i[1]||(i[1]=B(()=>{},["prevent"]))},{default:o(()=>[s(S,{label:e.$t("views.team.teamForm.form.userName.label"),prop:"users"},{default:o(()=>[s(A,{tags:f.value.users,"onUpdate:tags":i[0]||(i[0]=t=>f.value.users=t),placeholder:e.$t("views.team.teamForm.form.userName.placeholder")},null,8,["tags","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});const Ue=W(Ne,[["__scopeId","data-v-70f8d926"]]);var a=(m=>(m.MANAGE="MANAGE",m.USE="USE",m.DATASET="DATASET",m.APPLICATION="APPLICATION",m))(a||{});const Ve={class:"p-24 pt-0"},we={class:"flex align-center"},Te=R({__name:"PermissionSetting",props:{data:{type:Array,default:()=>[]},id:String,type:String,tableHeight:Number,manage:Boolean},emits:["update:data"],setup(m,{emit:T}){const _=m,E=P(()=>_.type===a.DATASET),v=P(()=>_.type===a.APPLICATION),f=p({[a.MANAGE]:P({get:()=>u.value.some(n=>n.operate[a.MANAGE]),set:n=>{n?u.value.map(e=>{e.operate[a.MANAGE]=!0,e.operate[a.USE]=!0}):u.value.map(e=>{e.operate[a.MANAGE]=!1})}}),[a.USE]:P({get:()=>u.value.some(n=>n.operate[a.USE]),set:n=>{n?u.value.map(e=>{e.operate[a.USE]=!0}):u.value.map(e=>{e.operate[a.USE]=!1,e.operate[a.MANAGE]=!1})}})}),h=p(""),u=P(()=>_.data.filter(n=>n.name.toLowerCase().includes(h.value.toLowerCase()))),w=p({[a.MANAGE]:P(()=>u.value.every(e=>!e.operate[a.MANAGE])?!1:!u.value.every(e=>e.operate[a.MANAGE])),[a.USE]:P(()=>u.value.every(e=>!e.operate[a.USE])?!1:!u.value.every(e=>e.operate[a.USE]))});function G(n,e,i){_.data.map(A=>{A.id===e.id&&(A.operate[n]=i,n===a.MANAGE&&i?A.operate[a.USE]=!0:n===a.USE&&!i&&(A.operate[a.MANAGE]=!1))})}return(n,e)=>{const i=r("el-input"),A=r("AppAvatar"),S=r("auto-tooltip"),k=r("el-table-column"),N=r("el-checkbox"),x=r("el-table");return y(),O(X,null,[s(i,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:n.$t("common.search"),"prefix-icon":"Search",class:"p-24 pt-0 pb-0 mb-16 mt-4",clearable:""},null,8,["modelValue","placeholder"]),d("div",Ve,[s(x,{data:u.value,"max-height":m.tableHeight},{default:o(()=>[s(k,{prop:"name",label:v.value?n.$t("views.application.applicationForm.form.appName.label"):n.$t("views.dataset.datasetForm.form.datasetName.label")},{default:o(({row:t})=>[d("div",we,[v.value?(y(),V(A,{key:0,name:t.name,pinyinColor:"",class:"mr-12",shape:"square",size:24},null,8,["name"])):E.value?(y(),V(A,{key:1,class:"mr-12 avatar-blue",shape:"square",size:24},{default:o(()=>e[3]||(e[3]=[d("img",{src:ve,style:{width:"58%"},alt:""},null,-1)])),_:1})):q("",!0),s(S,{content:t==null?void 0:t.name},{default:o(()=>[D($(t==null?void 0:t.name),1)]),_:2},1032,["content"])])]),_:1},8,["label"]),s(k,{label:n.$t("views.team.setting.management"),align:"center",width:"100",fixed:"right"},{header:o(()=>[s(N,{disabled:_.manage,modelValue:f.value[M(a).MANAGE],"onUpdate:modelValue":e[1]||(e[1]=t=>f.value[M(a).MANAGE]=t),indeterminate:w.value[M(a).MANAGE],label:n.$t("views.team.setting.management")},null,8,["disabled","modelValue","indeterminate","label"])]),default:o(({row:t})=>[s(N,{disabled:_.manage,modelValue:t.operate[M(a).MANAGE],"onUpdate:modelValue":C=>t.operate[M(a).MANAGE]=C,onChange:C=>G(M(a).MANAGE,t,C)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),s(k,{label:n.$t("views.team.setting.check"),align:"center",width:"100",fixed:"right"},{header:o(()=>[s(N,{disabled:_.manage,modelValue:f.value[M(a).USE],"onUpdate:modelValue":e[2]||(e[2]=t=>f.value[M(a).USE]=t),indeterminate:w.value[M(a).USE],label:n.$t("views.team.setting.check")},null,8,["disabled","modelValue","indeterminate","label"])]),default:o(({row:t})=>[s(N,{disabled:_.manage,modelValue:t.operate[M(a).USE],"onUpdate:modelValue":C=>t.operate[M(a).USE]=C,onChange:C=>G(M(a).USE,t,C)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","max-height"])])],64)}}}),Ge={class:"team-manage flex main-calc-height"},Pe={class:"team-member p-8 border-r"},De={class:"flex-between p-16"},xe={class:"team-member-input"},Ie={class:"list-height-left"},Le={class:"flex-between"},Fe={class:"mr-8"},Be={class:"cursor"},He={class:"permission-setting flex"},Oe={class:"team-manage__table"},qe={class:"p-24 pb-0 mb-4"},Re={class:"submit-button"},ze=R({__name:"index",setup(m){const T=p(),_=p(!1),E=p(!1),v=p([]),f=p([]),h=p(""),u=p(""),w=p(""),G=p(a.DATASET),n=p(0),e=fe([{label:U("views.dataset.title"),value:a.DATASET,data:[]},{label:U("views.application.title"),value:a.APPLICATION,data:[]}]);Z(w,l=>{l?f.value=v.value.filter(c=>c.username.toLowerCase().includes(l.toLowerCase())):f.value=v.value});function i(l){return l==="manage"}function A(){E.value=!0;const l={team_member_permission_list:[]};e.map(c=>{c.data.map(b=>{l.team_member_permission_list.push({target_id:b.id,type:b.type,operate:b.operate})})}),I.putMemberPermissions(h.value,l).then(()=>{H(U("common.submitSuccess")),S(h.value)}).catch(()=>{E.value=!1})}function S(l){E.value=!0,I.getMemberPermissions(l).then(c=>{(!c.data||Object.keys(c.data).length>0)&&e.map(b=>{Object.keys(c.data).indexOf(b.value)!==-1&&(b.data=c.data[b.value])}),E.value=!1}).catch(()=>{E.value=!1})}function k(l){he(`${U("views.team.delete.confirmTitle")}${l.username}?`,U("views.team.delete.confirmMessage"),{confirmButtonText:U("common.confirm"),confirmButtonClass:"danger"}).then(()=>{_.value=!0,I.delTeamMember(l.id).then(()=>{H(U("common.deleteSuccess")),t()}).catch(()=>{_.value=!1})}).catch(()=>{})}function N(l){h.value=l.id,u.value=l.type,S(l.id)}function x(){var l;(l=T.value)==null||l.open()}function t(l){_.value=!0,I.getTeamMember().then(c=>{v.value=c.data,f.value=c.data;const b=l&&v.value.find(F=>F.user_id===l)||null;h.value=b?b.id:v.value[0].id,u.value=b?b.type:v.value[0].type,S(h.value),_.value=!1}).catch(()=>{_.value=!1})}function C(l){t(l&&l[0])}return Q(()=>{n.value=window.innerHeight-330,window.onresize=()=>(()=>{n.value=window.innerHeight-330})(),t()}),(l,c)=>{const b=r("AppIcon"),F=r("el-button"),Y=r("el-input"),ee=r("el-tag"),ae=r("MoreFilled"),te=r("el-icon"),le=r("el-dropdown-item"),ne=r("el-dropdown-menu"),oe=r("el-dropdown"),se=r("common-list"),re=r("el-scrollbar"),ie=r("el-tab-pane"),ue=r("el-tabs"),de=r("LayoutContainer"),z=be("loading");return y(),V(de,{header:l.$t("views.team.title")},{default:o(()=>[d("div",Ge,[d("div",Pe,[d("div",De,[d("h4",null,$(l.$t("views.team.member")),1),s(F,{type:"primary",link:"",onClick:x},{default:o(()=>[s(b,{iconName:"app-add-users",class:"add-user-icon"})]),_:1})]),d("div",xe,[s(Y,{modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=g=>w.value=g),placeholder:l.$t("views.team.searchBar.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),d("div",Ie,[s(re,null,{default:o(()=>[J((y(),V(se,{data:f.value,class:"mt-8",onClick:N,"default-active":h.value},{default:o(({row:g})=>[d("div",Le,[d("div",null,[d("span",Fe,$(g.username),1),i(g.type)?(y(),V(ee,{key:0,class:"default-tag"},{default:o(()=>[D($(l.$t("views.team.manage")),1)]),_:1})):q("",!0)]),d("div",{onClick:c[1]||(c[1]=B(()=>{},["stop"])),style:{"margin-top":"5px"}},[i(g.type)?q("",!0):(y(),V(oe,{key:0,trigger:"click"},{dropdown:o(()=>[s(ne,null,{default:o(()=>[s(le,{onClick:B(j=>k(g),["prevent"])},{default:o(()=>[D($(l.$t("views.team.delete.button")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[d("span",Be,[s(te,{class:"rotate-90"},{default:o(()=>[s(ae)]),_:1})])]),_:2},1024))])])]),_:1},8,["data","default-active"])),[[z,_.value]])]),_:1})])]),J((y(),O("div",He,[d("div",Oe,[d("h4",qe,$(l.$t("views.team.permissionSetting")),1),s(ue,{modelValue:G.value,"onUpdate:modelValue":c[2]||(c[2]=g=>G.value=g),class:"team-manage__tabs"},{default:o(()=>[(y(!0),O(X,null,ge(e,(g,j)=>(y(),V(ie,{key:g.value,label:g.label,name:g.value},{default:o(()=>[(y(),V(Te,{key:j,data:g.data,type:g.value,tableHeight:n.value,manage:i(u.value)},null,8,["data","type","tableHeight","manage"]))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),d("div",Re,[s(F,{type:"primary",onClick:A},{default:o(()=>[D($(l.$t("common.save")),1)]),_:1})])])),[[z,E.value]])]),s(Ue,{ref_key:"CreateMemberRef",ref:T,onRefresh:C},null,512)]),_:1},8,["header"])}}});const Je=W(ze,[["__scopeId","data-v-b1831dbc"]]);export{Je as default};
