import{cp as H,cq as m,d3 as I,cZ as r,d0 as X,cu as u,cx as S,cF as D,cA as o,cB as b,cz as l,cE as U,cK as C,cJ as y,cN as Y,ez as F,dh as A,d1 as x,ct as ee,cU as le,cv as ae,cH as oe,du as se,eA as te,dV as ne,dW as re,c_ as E,cR as ue}from"./index-1a322249.js";const ie={class:"dialog-footer"},me=H({__name:"UserDialog",props:{title:String},emits:["refresh"],setup(z,{expose:R,emit:O}){const h=O,w=m(),s=m({username:"",email:"",password:"",phone:"",nick_name:""}),v=I({username:[{required:!0,message:r("views.user.userForm.form.username.requiredMessage"),trigger:"blur"},{min:6,max:20,message:r("views.user.userForm.form.username.lengthMessage"),trigger:"blur"}],email:[{required:!0,message:r("views.user.userForm.form.email.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:r("views.user.userForm.form.password.requiredMessage"),trigger:"blur"},{min:6,max:20,message:r("views.user.userForm.form.password.lengthMessage"),trigger:"blur"}]}),i=m(!1),g=m(!1),c=m(!1);X(i,a=>{var t;a||(s.value={username:"",email:"",password:"",phone:"",nick_name:""},c.value=!1,(t=w.value)==null||t.clearValidate())});const q=a=>{a&&(s.value.id=a.id,s.value.username=a.username,s.value.email=a.email,s.value.password=a.password,s.value.phone=a.phone,s.value.nick_name=a.nick_name,c.value=!0),i.value=!0},B=async a=>{a&&await a.validate((t,_)=>{t&&(c.value?F.putUserManage(s.value.id,s.value,g).then(p=>{h("refresh"),A(r("common.editSuccess")),i.value=!1}):F.postUserManage(s.value,g).then(p=>{h("refresh"),A(r("common.createSuccess")),i.value=!1}))})};return R({open:q}),(a,t)=>{const _=u("el-input"),p=u("el-form-item"),T=u("el-form"),d=u("el-button"),M=u("el-dialog");return S(),D(M,{title:z.title,modelValue:i.value,"onUpdate:modelValue":t[8]||(t[8]=e=>i.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[b("span",ie,[l(d,{onClick:t[6]||(t[6]=U(e=>i.value=!1,["prevent"]))},{default:o(()=>[C(y(a.$t("common.cancel")),1)]),_:1}),l(d,{type:"primary",onClick:t[7]||(t[7]=e=>B(w.value)),loading:g.value},{default:o(()=>[C(y(a.$t("common.save")),1)]),_:1},8,["loading"])])]),default:o(()=>[l(T,{ref_key:"userFormRef",ref:w,model:s.value,rules:v,"label-position":"top","require-asterisk-position":"right",onSubmit:t[5]||(t[5]=U(()=>{},["prevent"])),"close-on-click-modal":!1,"close-on-press-escape":!1},{default:o(()=>[l(p,{prop:c.value?"":"username",label:a.$t("views.user.userForm.form.username.label")},{default:o(()=>[l(_,{modelValue:s.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.username=e),placeholder:a.$t("views.user.userForm.form.username.placeholder"),maxlength:"20","show-word-limit":"",disabled:c.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["prop","label"]),l(p,{label:a.$t("views.user.userForm.form.nick_name.label")},{default:o(()=>[l(_,{modelValue:s.value.nick_name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.nick_name=e),placeholder:a.$t("views.user.userForm.form.nick_name.placeholder"),maxlength:"64","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.email.label"),prop:"email"},{default:o(()=>[l(_,{type:"email",modelValue:s.value.email,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.email=e),placeholder:a.$t("views.user.userForm.form.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.phone.label")},{default:o(()=>[l(_,{modelValue:s.value.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.phone=e),placeholder:a.$t("views.user.userForm.form.phone.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c.value?Y("",!0):(S(),D(p,{key:0,label:a.$t("views.user.userForm.form.password.label"),prop:"password"},{default:o(()=>[l(_,{type:"password",modelValue:s.value.password,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.password=e),placeholder:a.$t("views.user.userForm.form.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]))]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),ce={class:"p-24"},de={class:"flex-between"},pe={class:"mr-4"},fe={class:"mr-4"},ve={class:"mr-4"},_e=H({__name:"index",setup(z){const{common:R,user:O}=x(),h=m(),w=m(),s=m(""),v=m(!1),i=I({current_page:1,page_size:20,total:0}),g=m([]),c=m("");function q(){i.total=0,i.current_page=1,g.value=[],d()}function B(e,k){const $={is_active:e},L=e?r("common.status.enableSuccess"):r("common.status.disableSuccess");F.putUserManage(k.id,$,v).then(f=>{d(),A(L)})}function a(e){w.value.open(e)}function t(e){s.value=r("views.user.editUser"),h.value.open(e)}function _(){R.asyncGetValid(ne.User,re.User,v).then(async e=>{e!=null&&e.data?(s.value=r("views.user.createUser"),h.value.open()):(e==null?void 0:e.code)===400&&E(r("common.tip"),r("views.user.tip.professionalMessage"),{cancelButtonText:r("common.confirm"),confirmButtonText:r("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")}).catch(()=>{})})}function p(e){E(`${r("views.user.delete.confirmTitle")}${e.username} ?`,r("views.user.delete.confirmMessage"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{v.value=!0,F.delUserManage(e.id,v).then(()=>{A(r("common.deleteSuccess")),d()})}).catch(()=>{})}function T(){i.current_page=1,d()}function d(){return F.getUserManage(i,c.value,v).then(e=>{g.value=e.data.records,i.total=e.data.total})}function M(){d()}return ee(()=>{d()}),(e,k)=>{const $=u("el-button"),L=u("el-input"),f=u("el-table-column"),j=u("el-switch"),G=u("EditPen"),N=u("el-icon"),P=u("el-tooltip"),J=u("Lock"),K=u("Delete"),W=u("app-table"),Z=u("LayoutContainer"),Q=le("loading");return S(),D(Z,{header:e.$t("views.user.title")},{default:o(()=>[b("div",ce,[b("div",de,[l($,{type:"primary",onClick:_},{default:o(()=>[C(y(e.$t("views.user.createUser")),1)]),_:1}),l(L,{modelValue:c.value,"onUpdate:modelValue":k[0]||(k[0]=n=>c.value=n),onChange:q,placeholder:e.$t("common.search"),"prefix-icon":"Search",class:"w-240",clearable:""},null,8,["modelValue","placeholder"])]),ae((S(),D(W,{class:"mt-16",data:g.value,"pagination-config":i,onSizeChange:T,onChangePage:d},{default:o(()=>[l(f,{prop:"username",label:e.$t("views.user.userForm.form.username.label")},null,8,["label"]),l(f,{prop:"nick_name",label:e.$t("views.user.userForm.form.nick_name.label")},null,8,["label"]),l(f,{prop:"email",label:e.$t("views.user.userForm.form.email.label"),"show-overflow-tooltip":""},null,8,["label"]),l(f,{prop:"phone",label:e.$t("views.user.userForm.form.phone.label")},null,8,["label"]),l(f,{prop:"source",label:e.$t("views.user.source.label")},{default:o(({row:n})=>[C(y(n.source==="LOCAL"?e.$t("views.user.source.local"):n.source==="wecom"?e.$t("views.user.source.wecom"):n.source==="lark"?e.$t("views.user.source.lark"):n.source==="dingtalk"?e.$t("views.user.source.dingtalk"):n.source==="OAUTH2"||n.source==="OAuth2"?"OAuth2":n.source),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.status.label"),width:"80"},{default:o(({row:n})=>[b("div",{onClick:k[1]||(k[1]=U(()=>{},["stop"]))},[l(j,{disabled:n.role==="ADMIN",size:"small",modelValue:n.is_active,"onUpdate:modelValue":V=>n.is_active=V,onChange:V=>B(V,n)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])])]),_:1},8,["label"]),l(f,{label:e.$t("common.createTime"),width:"180"},{default:o(({row:n})=>[C(y(oe(se)(n.create_time)),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.operation"),width:"110",align:"left",fixed:"right"},{default:o(({row:n})=>[b("span",pe,[l(P,{effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:o(()=>[l($,{type:"primary",text:"",onClick:U(V=>t(n),["stop"])},{default:o(()=>[l(N,null,{default:o(()=>[l(G)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),b("span",fe,[l(P,{effect:"dark",content:e.$t("views.user.setting.updatePwd"),placement:"top"},{default:o(()=>[l($,{type:"primary",text:"",onClick:U(V=>a(n),["stop"])},{default:o(()=>[l(N,null,{default:o(()=>[l(J)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),b("span",ve,[l(P,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:o(()=>[l($,{disabled:n.role==="ADMIN",type:"primary",text:"",onClick:U(V=>p(n),["stop"])},{default:o(()=>[l(N,null,{default:o(()=>[l(K)]),_:1})]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[Q,v.value]])]),l(me,{title:s.value,ref_key:"UserDialogRef",ref:h,onRefresh:M},null,8,["title"]),l(te,{ref_key:"UserPwdDialogRef",ref:w,onRefresh:M},null,512)]),_:1},8,["header"])}}});const be=ue(_e,[["__scopeId","data-v-7f8858e8"]]);export{be as default};
