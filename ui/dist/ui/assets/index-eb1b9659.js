import{cp as ve,d1 as _e,dt as me,cq as v,d3 as fe,cZ as g,d0 as Ie,cu as s,cx as c,cF as _,cA as t,cB as p,cz as l,cE as B,cK as m,cJ as u,cy as T,cC as ee,cD as te,dp as Ae,dq as Ue,dr as Le,cN as z,ef as ae,ct as qe,cU as Te,cv as xe,cV as de,cH as re,e5 as ce,dh as Y,c_ as pe,el as Fe,cR as Ne}from"./index-1a322249.js";import{_ as Ge}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-c3505a07.js";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang-50be941a.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-5e53ebbc.js";const Qe={class:"flex align-center"},je={class:"dialog-footer"},Ee=ve({__name:"SelectDocumentDialog",emits:["refresh"],setup(ge,{expose:x,emit:K}){const{dataset:P,document:S}=_e(),F=me(),{params:{id:I,documentId:w}}=F,A=K,k=v(),i=v(!1),V=v(!1),f=v({dataset_id:"",document_id:""}),U=fe({dataset_id:[{required:!0,message:g("views.log.selectDatasetPlaceholder"),trigger:"change"}],document_id:[{required:!0,message:g("views.log.documentPlaceholder"),trigger:"change"}]}),y=v([]),d=v([]),h=v(!1),L=v([]);Ie(i,r=>{var o;r||(f.value={dataset_id:"",document_id:""},y.value=[],d.value=[],L.value=[],(o=k.value)==null||o.clearValidate())});function N(r){f.value.document_id="",O(r)}function O(r){S.asyncGetAllDocument(r,V).then(o=>{var $;d.value=($=o.data)==null?void 0:$.filter(M=>M.id!==w)})}function G(){P.asyncGetAllDataset(V).then(r=>{y.value=r.data})}const Z=r=>{var o;L.value=r,G(),(o=k.value)==null||o.clearValidate(),i.value=!0},W=async r=>{r&&await r.validate((o,$)=>{o&&ae.putMigrateMulParagraph(I,w,f.value.dataset_id,f.value.document_id,L.value,V).then(()=>{A("refresh"),i.value=!1})})};return x({open:Z}),(r,o)=>{const $=s("AppAvatar"),M=s("el-option"),H=s("el-select"),R=s("el-form-item"),Q=s("el-form"),q=s("el-button"),j=s("el-dialog");return c(),_(j,{title:`${r.$t("views.log.selectDataset")}/${r.$t("common.fileUpload.document")}`,modelValue:i.value,"onUpdate:modelValue":o[5]||(o[5]=e=>i.value=e),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[p("span",je,[l(q,{onClick:o[3]||(o[3]=B(e=>i.value=!1,["prevent"]))},{default:t(()=>[m(u(r.$t("common.cancel")),1)]),_:1}),l(q,{type:"primary",onClick:o[4]||(o[4]=e=>W(k.value)),loading:V.value},{default:t(()=>[m(u(r.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(Q,{ref_key:"formRef",ref:k,model:f.value,"label-position":"top","require-asterisk-position":"right",rules:U,onSubmit:o[2]||(o[2]=B(()=>{},["prevent"]))},{default:t(()=>[l(R,{label:r.$t("views.log.selectDataset"),prop:"dataset_id"},{default:t(()=>[l(H,{modelValue:f.value.dataset_id,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value.dataset_id=e),filterable:"",placeholder:r.$t("views.log.selectDatasetPlaceholder"),loading:h.value,onChange:N},{default:t(()=>[(c(!0),T(ee,null,te(y.value,e=>(c(),_(M,{key:e.id,label:e.name,value:e.id},{default:t(()=>[p("span",Qe,[!e.dataset_id&&e.type==="1"?(c(),_($,{key:0,class:"mr-12 avatar-purple",shape:"square",size:24},{default:t(()=>o[6]||(o[6]=[p("img",{src:Ae,style:{width:"58%"},alt:""},null,-1)])),_:1})):!e.dataset_id&&e.type==="2"?(c(),_($,{key:1,class:"mr-12 avatar-purple",shape:"square",size:24,style:{background:"none"}},{default:t(()=>o[7]||(o[7]=[p("img",{src:Ue,style:{width:"100%"},alt:""},null,-1)])),_:1})):!e.dataset_id&&e.type==="0"?(c(),_($,{key:2,class:"mr-12 avatar-blue",shape:"square",size:24},{default:t(()=>o[8]||(o[8]=[p("img",{src:Le,style:{width:"58%"},alt:""},null,-1)])),_:1})):z("",!0),m(" "+u(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"]),l(R,{label:r.$t("views.log.saveToDocument"),prop:"document_id"},{default:t(()=>[l(H,{modelValue:f.value.document_id,"onUpdate:modelValue":o[1]||(o[1]=e=>f.value.document_id=e),filterable:"",placeholder:r.$t("views.log.documentPlaceholder"),loading:h.value},{default:t(()=>[(c(!0),T(ee,null,te(d.value,e=>(c(),_(M,{key:e.id,label:e.name,value:e.id},{default:t(()=>[m(u(e.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Je={style:{width:"78%"}},Ke={style:{display:"inline-block"}},Oe={class:"break-all"},Ze={class:"header-button"},We={class:"document-detail__main p-16"},Xe={class:"flex-between p-8"},Ye={class:"document-detail-height"},et={class:"footer-content flex-between"},tt={class:"footer-content flex-between"},at={key:0,class:"mul-operation border-t w-full"},lt={class:"ml-8"},nt=ve({__name:"index",setup(ge){const{paragraph:x}=_e(),K=me(),{params:{id:P,documentId:S}}=K,F=v(),I=v(),w=v(!1),A=v(!1),k=v({}),i=v([]),V=v(""),f=v(""),U=v("title"),y=v(!1),d=v([]),h=fe({current_page:1,page_size:30,total:0});function L(){i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],Y(g("views.document.tip.migrationSuccess"))}function N(e){e&&(d.value=[e.id]),F.value.open(d.value)}function O(){pe(`${g("views.document.delete.confirmTitle1")} ${d.value.length} ${g("views.document.delete.confirmTitle2")}`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.confirm"),confirmButtonClass:"danger"}).then(()=>{ae.delMulParagraph(P,S,d.value,A).then(()=>{i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],Y(g("views.document.delete.successMessage"))})}).catch(()=>{})}function G(e){y.value=e,d.value=[]}function Z(e){d.value.includes(e)?d.value.splice(d.value.indexOf(e),1):d.value.push(e)}function W(){h.current_page=1,i.value=[],R()}function r(e){const a={is_active:!e.is_active};x.asyncPutParagraph(P,S,e.id,a,A).then(C=>{const E=i.value.findIndex(D=>D.id===e.id);return i.value[E].is_active=!i.value[E].is_active,!0}).catch(()=>!1)}function o(e){pe(`${g("views.paragraph.delete.confirmTitle")} ${e.title||"-"} ?`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.confirm"),confirmButtonClass:"danger"}).then(()=>{x.asyncDelParagraph(P,S,e.id,w).then(()=>{const a=i.value.findIndex(C=>C.id===e.id);i.value.splice(a,1),Y(g("common.deleteSuccess"))})}).catch(()=>{})}function $(){V.value=g("views.paragraph.addParagraph"),I.value.open()}function M(e){V.value=g("views.paragraph.paragraphDetail"),I.value.open(e)}function H(){w.value=!0,Fe.getDocumentDetail(P,S).then(e=>{k.value=e.data,w.value=!1}).catch(()=>{w.value=!1})}function R(){ae.getParagraph(P,S,h,f.value&&{[U.value]:f.value},w).then(e=>{i.value=[...i.value,...e.data.records],h.total=e.data.total})}function Q(e){if(e){const a=i.value.findIndex(C=>C.id===e.id);i.value.splice(a,1,e)}else h.current_page=1,i.value=[],R()}const q=v();function j(e){const a=[];e?a.push(e.id):d.value.map(C=>{C&&a.push(C)}),q.value.open(a,"paragraph")}return qe(()=>{H(),R()}),(e,a)=>{const C=s("el-link"),E=s("el-text"),D=s("el-button"),le=s("el-option"),he=s("el-select"),we=s("el-input"),be=s("el-empty"),ne=s("CardBox"),ke=s("el-switch"),ye=s("MoreFilled"),oe=s("el-icon"),$e=s("Connection"),X=s("el-dropdown-item"),Ce=s("AppIcon"),De=s("el-dropdown-menu"),Ve=s("el-dropdown"),Pe=s("el-col"),Se=s("el-row"),Re=s("InfiniteScroll"),Me=s("el-scrollbar"),ze=s("LayoutContainer"),Be=Te("loading");return c(),_(ze,{"back-to":"-1",class:"document-detail"},{header:t(()=>{var n,J;return[p("div",Je,[p("h3",Ke,u((n=k.value)==null?void 0:n.name),1),((J=k.value)==null?void 0:J.type)==="1"?(c(),_(E,{key:0,type:"info"},{default:t(()=>{var b,se;return[m("（"+u(e.$t("views.document.form.source_url.label"))+"：",1),l(C,{href:(se=(b=k.value)==null?void 0:b.meta)==null?void 0:se.source_url,target:"_blank"},{default:t(()=>{var ie,ue;return[p("span",Oe,u((ue=(ie=k.value)==null?void 0:ie.meta)==null?void 0:ue.source_url),1)]}),_:1},8,["href"]),a[10]||(a[10]=m("） "))]}),_:1})):z("",!0)]),p("div",Ze,[y.value===!1?(c(),_(D,{key:0,onClick:a[0]||(a[0]=b=>G(!0))},{default:t(()=>[m(u(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):z("",!0),y.value===!0?(c(),_(D,{key:1,onClick:a[1]||(a[1]=b=>G(!1))},{default:t(()=>[m(u(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):z("",!0),y.value===!1?(c(),_(D,{key:2,onClick:$,type:"primary",disabled:w.value},{default:t(()=>[m(u(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):z("",!0)])]}),default:t(()=>[xe((c(),T("div",We,[p("div",Xe,[p("span",null,u(h.total)+" "+u(e.$t("views.paragraph.paragraph_count")),1),l(we,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=n=>f.value=n),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:W,clearable:""},{prepend:t(()=>[l(he,{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=n=>U.value=n),placeholder:"Select",style:{width:"80px"}},{default:t(()=>[l(le,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(le,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(Me,null,{default:t(()=>[p("div",Ye,[i.value.length==0?(c(),_(be,{key:0,description:e.$t("common.noData")},null,8,["description"])):(c(),_(Re,{key:1,size:i.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[7]||(a[7]=n=>h.current_page=n),onLoad:R,loading:w.value},{default:t(()=>[l(Se,null,{default:t(()=>[(c(!0),T(ee,null,te(i.value,(n,J)=>(c(),_(Pe,{xs:24,sm:12,md:8,lg:6,xl:6,key:J,class:"p-8"},{default:t(()=>[y.value===!0?(c(),_(ne,{key:0,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",d.value.includes(n.id)?"selected":""]),showIcon:!1,onClick:b=>Z(n.id)},{footer:t(()=>[p("div",et,[p("span",null,u(re(ce)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1)])]),default:t(()=>[p("div",{class:"active-button",onClick:a[4]||(a[4]=B(()=>{},["stop"]))})]),_:2},1032,["title","description","class","onClick"])):(c(),_(ne,{key:1,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",n.is_active?"":"disabled"]),showIcon:!1,onClick:b=>M(n)},{footer:t(()=>[p("div",tt,[p("span",null,u(re(ce)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1),p("span",{onClick:a[6]||(a[6]=B(()=>{},["stop"]))},[l(Ve,{trigger:"click"},{dropdown:t(()=>[l(De,null,{default:t(()=>[l(X,{onClick:b=>j(n)},{default:t(()=>[l(oe,null,{default:t(()=>[l($e)]),_:1}),m(" "+u(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"]),l(X,{onClick:b=>N(n)},{default:t(()=>[l(Ce,{iconName:"app-migrate"}),m(" "+u(e.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(X,{icon:"Delete",onClick:B(b=>o(n),["stop"])},{default:t(()=>[m(u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[l(D,{text:""},{default:t(()=>[l(oe,null,{default:t(()=>[l(ye)]),_:1})]),_:1})]),_:2},1024)])])]),default:t(()=>[p("div",{class:"active-button",onClick:a[5]||(a[5]=B(()=>{},["stop"]))},[l(ke,{loading:w.value,modelValue:n.is_active,"onUpdate:modelValue":b=>n.is_active=b,"before-change":()=>r(n),size:"small"},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:2},1032,["title","description","class","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1}),y.value===!0?(c(),T("div",at,[l(D,{disabled:d.value.length===0,onClick:a[8]||(a[8]=n=>j())},{default:t(()=>[m(u(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(D,{disabled:d.value.length===0,onClick:a[9]||(a[9]=n=>N())},{default:t(()=>[m(u(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(D,{disabled:d.value.length===0,onClick:O},{default:t(()=>[m(u(e.$t("common.delete")),1)]),_:1},8,["disabled"]),p("span",lt,u(e.$t("views.document.selected"))+" "+u(d.value.length)+" "+u(e.$t("views.document.items")),1)])):z("",!0)])),[[Be,h.current_page===1&&w.value||A.value]]),l(Ge,{ref_key:"ParagraphDialogRef",ref:I,title:V.value,onRefresh:Q},null,8,["title"]),l(Ee,{ref_key:"SelectDocumentDialogRef",ref:F,onRefresh:L},null,512),l(He,{ref_key:"GenerateRelatedDialogRef",ref:q,onRefresh:Q},null,512)]),_:1})}}});const dt=Ne(nt,[["__scopeId","data-v-70936a42"]]);export{dt as default};
