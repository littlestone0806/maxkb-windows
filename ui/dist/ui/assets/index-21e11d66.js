var ft=Object.defineProperty;var _t=(P,b,T)=>b in P?ft(P,b,{enumerable:!0,configurable:!0,writable:!0,value:T}):P[b]=T;var Ie=(P,b,T)=>(_t(P,typeof b!="symbol"?b+"":b,T),T);import{cp as re,dt as Ce,cq as R,d3 as gt,cZ as r,d0 as Be,cu as u,cx as m,cF as _,cA as e,cB as k,cz as l,cE as Z,cK as o,cJ as n,cN as q,cy as ae,cC as he,cD as ke,cH as s,el as j,dh as Q,d1 as Le,cU as Ue,cV as J,cv as Pe,dr as yt,dp as ht,dq as kt,cr as fe,cT as Ve,dC as Et,dv as bt,eq as $t,er as Ct,ct as Dt,dx as St,e5 as wt,du as Ae,c_ as ve,cY as Rt,cR as Mt}from"./index-1a322249.js";import{S as Nt}from"./SyncWebDialog-88f2a427.js";import{_ as Tt}from"./index.vue_vue_type_script_setup_true_lang-50be941a.js";var ye=(P=>(P.optimization="views.document.hitHandlingMethod.optimization",P.directly_return="views.document.hitHandlingMethod.directly_return",P))(ye||{});const It={class:"flex align-center"},Vt={class:"mr-4"},At={class:"lighter w-full",style:{"margin-top":"-20px"}},Gt={class:"dialog-footer"},Bt=re({__name:"ImportDocumentDialog",props:{title:String},emits:["refresh"],setup(P,{expose:b,emit:T}){const S=Ce(),{params:{id:h}}=S,K=T,E=R(),g=R(!1),f=R(!1),i=R({source_url:"",selector:"",hit_handling_method:"optimization",directly_return_similarity:.9}),M=R(""),G=R(""),D=R([]),y=gt({source_url:[{required:!0,message:r("views.document.form.source_url.requiredMessage"),trigger:"blur"}],directly_return_similarity:[{required:!0,message:r("views.document.form.similarity.requiredMessage"),trigger:"blur"}]}),$=R(!1);Be($,p=>{p||(i.value={source_url:"",selector:"",hit_handling_method:"optimization",directly_return_similarity:.9},f.value=!1,G.value="",M.value="",D.value=[])});const C=(p,w)=>{p?(G.value=p.type,M.value=p.id,i.value={hit_handling_method:p.hit_handling_method,directly_return_similarity:p.directly_return_similarity,...p.meta},f.value=!1):w?D.value=w:(G.value="1",f.value=!0),$.value=!0},U=async p=>{p&&await p.validate(w=>{if(w){if(f.value){const I={source_url_list:i.value.source_url.split(`
`),selector:i.value.selector};j.postWebDocument(h,I,g).then(()=>{Q(r("views.document.tip.importMessage")),K("refresh"),$.value=!1})}else if(M.value){const I={hit_handling_method:i.value.hit_handling_method,directly_return_similarity:i.value.directly_return_similarity,meta:{source_url:i.value.source_url,selector:i.value.selector}};j.putDocument(h,M.value,I,g).then(()=>{Q(r("common.settingSuccess")),K("refresh"),$.value=!1})}else if(D.value.length>0){const I={hit_handling_method:i.value.hit_handling_method,directly_return_similarity:i.value.directly_return_similarity,id_list:D.value};j.batchEditHitHandling(h,I,g).then(()=>{Q(r("common.settingSuccess")),K("refresh"),$.value=!1})}}})};return b({open:C}),(p,w)=>{const I=u("el-input"),z=u("el-form-item"),Y=u("AppIcon"),ee=u("el-tooltip"),B=u("el-radio"),le=u("el-radio-group"),ie=u("el-input-number"),ue=u("el-form"),oe=u("el-button"),ce=u("el-dialog");return m(),_(ce,{title:P.title,modelValue:$.value,"onUpdate:modelValue":w[7]||(w[7]=O=>$.value=O),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,width:"550"},{footer:e(()=>[k("span",Gt,[l(oe,{onClick:w[5]||(w[5]=Z(O=>$.value=!1,["prevent"]))},{default:e(()=>[o(n(p.$t("common.cancel")),1)]),_:1}),l(oe,{type:"primary",onClick:w[6]||(w[6]=O=>U(E.value)),loading:g.value},{default:e(()=>[o(n(p.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:e(()=>[l(ue,{"label-position":"top",ref_key:"webFormRef",ref:E,rules:y,model:i.value,"require-asterisk-position":"right"},{default:e(()=>[f.value?(m(),_(z,{key:0,label:p.$t("views.document.form.source_url.label"),prop:"source_url"},{default:e(()=>[l(I,{modelValue:i.value.source_url,"onUpdate:modelValue":w[0]||(w[0]=O=>i.value.source_url=O),placeholder:p.$t("views.document.form.source_url.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):!f.value&&G.value==="1"?(m(),_(z,{key:1,label:p.$t("views.document.form.source_url.label"),prop:"source_url"},{default:e(()=>[l(I,{modelValue:i.value.source_url,"onUpdate:modelValue":w[1]||(w[1]=O=>i.value.source_url=O),placeholder:p.$t("views.document.form.source_url.requiredMessage")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):q("",!0),G.value==="1"?(m(),_(z,{key:2,label:p.$t("views.document.form.selector.label")},{default:e(()=>[l(I,{modelValue:i.value.selector,"onUpdate:modelValue":w[2]||(w[2]=O=>i.value.selector=O),placeholder:p.$t("views.document.form.selector.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):q("",!0),f.value?q("",!0):(m(),_(z,{key:3},{label:e(()=>[k("div",It,[k("span",Vt,n(p.$t("views.document.form.hit_handling_method.label")),1),l(ee,{effect:"dark",content:p.$t("views.document.form.hit_handling_method.tooltip"),placement:"right"},{default:e(()=>[l(Y,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:e(()=>[l(le,{modelValue:i.value.hit_handling_method,"onUpdate:modelValue":w[3]||(w[3]=O=>i.value.hit_handling_method=O),class:"radio-block mt-4"},{default:e(()=>[(m(!0),ae(he,null,ke(s(ye),(O,N)=>(m(),_(B,{key:N,value:N},{default:e(()=>[o(n(p.$t(O)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),!f.value&&i.value.hit_handling_method==="directly_return"?(m(),_(z,{key:4,prop:"directly_return_similarity"},{default:e(()=>[k("div",At,[k("span",null,n(p.$t("views.document.form.similarity.label")),1),l(ie,{modelValue:i.value.directly_return_similarity,"onUpdate:modelValue":w[4]||(w[4]=O=>i.value.directly_return_similarity=O),min:0,max:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",size:"small",class:"ml-4 mr-4"},null,8,["modelValue"]),k("span",null,n(p.$t("views.document.form.similarity.placeholder")),1)])]),_:1})):q("",!0)]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Lt={class:"my-header flex"},Ut=["id"],Pt={class:"content-height"},zt={class:"p-16"},Ot={class:"flex align-center"},Ft=["title"],jt={class:"dialog-footer"},qt=re({__name:"SelectDatasetDialog",emits:["refresh"],setup(P,{expose:b,emit:T}){const{dataset:S}=Le(),h=Ce(),{params:{id:K}}=h,E=T,g=R(!1),f=R(!1),i=R(""),M=R([]),G=R([]);Be(f,U=>{U||(i.value="",M.value=[],G.value=[])});const D=U=>{G.value=U,$(),f.value=!0},y=()=>{j.putMigrateMulDocument(K,i.value,G.value,g).then(U=>{E("refresh"),f.value=!1})};function $(){S.asyncGetAllDataset(g).then(U=>{var p;M.value=(p=U.data)==null?void 0:p.filter(w=>w.id!==K)})}const C=()=>{$()};return b({open:D}),(U,p)=>{const w=u("Refresh"),I=u("el-icon"),z=u("el-button"),Y=u("AppAvatar"),ee=u("el-radio"),B=u("el-card"),le=u("el-col"),ie=u("el-row"),ue=u("el-scrollbar"),oe=u("el-radio-group"),ce=u("el-dialog"),O=Ue("loading");return m(),_(ce,{title:U.$t("views.log.selectDataset"),modelValue:f.value,"onUpdate:modelValue":p[2]||(p[2]=N=>f.value=N),width:"600",class:"select-dataset-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{header:e(({titleId:N,titleClass:se})=>[k("div",Lt,[k("h4",{id:N,class:J(se)},n(U.$t("views.log.selectDataset")),11,Ut),l(z,{link:"",class:"ml-16",onClick:C},{default:e(()=>[l(I,{class:"mr-4"},{default:e(()=>[l(w)]),_:1}),o(n(U.$t("common.refresh")),1)]),_:1})])]),footer:e(()=>[k("span",jt,[l(z,{onClick:p[1]||(p[1]=Z(N=>f.value=!1,["prevent"]))},{default:e(()=>[o(n(U.$t("common.cancel")),1)]),_:1}),l(z,{type:"primary",onClick:y,disabled:!i.value||g.value},{default:e(()=>[o(n(U.$t("common.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[k("div",Pt,[l(oe,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=N=>i.value=N),class:"card__radio"},{default:e(()=>[l(ue,{height:"500"},{default:e(()=>[k("div",zt,[Pe((m(),_(ie,{gutter:12},{default:e(()=>[(m(!0),ae(he,null,ke(M.value,(N,se)=>(m(),_(le,{span:12,key:se,class:"mb-16"},{default:e(()=>[l(B,{shadow:"never",class:J(N.id===i.value?"active":"")},{default:e(()=>[l(ee,{value:N.id,size:"large"},{default:e(()=>[k("div",Ot,[(N==null?void 0:N.type)==="0"?(m(),_(Y,{key:0,class:"mr-8 avatar-blue",shape:"square",size:32},{default:e(()=>p[3]||(p[3]=[k("img",{src:yt,style:{width:"58%"},alt:""},null,-1)])),_:1})):q("",!0),(N==null?void 0:N.type)==="1"?(m(),_(Y,{key:1,class:"mr-8 avatar-purple",shape:"square",size:32},{default:e(()=>p[4]||(p[4]=[k("img",{src:ht,style:{width:"58%"},alt:""},null,-1)])),_:1})):q("",!0),(N==null?void 0:N.type)==="2"?(m(),_(Y,{key:2,class:"mr-8 avatar-purple",shape:"square",size:32,style:{background:"none"}},{default:e(()=>p[5]||(p[5]=[k("img",{src:kt,style:{width:"100%"},alt:""},null,-1)])),_:1})):q("",!0),k("span",{class:"ellipsis",title:N.name},n(N.name),9,Ft)])]),_:2},1032,["value"])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),[[O,g.value]])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["title","modelValue"])}}});const A={EMBEDDING:1,GENERATE_PROBLEM:2,SYNC:3},v={PENDING:"0",STARTED:"1",SUCCESS:"2",FAILURE:"3",REVOKE:"4",REVOKED:"5",IGNORED:"n"};class Ge{constructor(b){Ie(this,"task_status");b||(b=""),b=b.split("").reverse().join(""),this.task_status={};for(let T in A){const S=A[T],h=S-1;this.task_status[S]=b[h]?b[h]:"n"}}toString(){const b=[];for(let T in A){const S=A[T];b.push(this.task_status[S])}return b.reverse().join("")}}const Kt=re({__name:"StatusTable",props:{status:{},statusMeta:{},stateMap:{},taskTypeMap:{}},setup(P){const b=P,T=E=>{const g=new Ge(E.status);return Object.keys(A).map(f=>{const i=A[f];return{[i]:{[g.task_status[i]]:E.count}}}).reduce((f,i)=>({...f,...i}),{})},S=(E,g)=>E==null&&g?g:g==null&&E?E:typeof E=="object"&&typeof g=="object"?Ve.mergeWith(E,g,S):E+g,h=fe(()=>(b.statusMeta.aggs?b.statusMeta.aggs:[]).map(E=>T(E)).reduce((E,g)=>Ve.mergeWith(E,g,S),{})),K=fe(()=>Object.keys(A).map(E=>{const g=A[E],f=new Ge(b.status);return{type:g,state:f.task_status[g],aggs:h.value[g],time:b.statusMeta.state_time[g]}}).filter(E=>E.state!==v.IGNORED));return(E,g)=>{const f=u("SuccessFilled"),i=u("el-icon"),M=u("el-text"),G=u("CircleCloseFilled"),D=u("Loading");return m(!0),ae(he,null,ke(K.value,y=>(m(),ae("div",{key:y.type},[k("span",null,n(E.taskTypeMap[y.type])+"：",1),k("span",null,[y.state===s(v).SUCCESS||y.state===s(v).REVOKED?(m(),_(M,{key:0},{default:e(()=>[l(i,{class:"success"},{default:e(()=>[l(f)]),_:1}),o(" "+n(E.stateMap[y.state](y.type)),1)]),_:2},1024)):y.state===s(v).FAILURE?(m(),_(M,{key:1},{default:e(()=>[l(i,{class:"danger"},{default:e(()=>[l(G)]),_:1}),o(" "+n(E.stateMap[y.state](y.type)),1)]),_:2},1024)):y.state===s(v).STARTED?(m(),_(M,{key:2},{default:e(()=>[l(i,{class:"is-loading primary"},{default:e(()=>[l(D)]),_:1}),o(" "+n(E.stateMap[y.state](y.type)),1)]),_:2},1024)):y.state===s(v).PENDING?(m(),_(M,{key:3},{default:e(()=>[l(i,{class:"is-loading primary"},{default:e(()=>[l(D)]),_:1}),o(" "+n(E.stateMap[y.state](y.type)),1)]),_:2},1024)):y.state===s(v).REVOKE?(m(),_(M,{key:4},{default:e(()=>[l(i,{class:"is-loading primary"},{default:e(()=>[l(D)]),_:1}),o(" "+n(E.stateMap[y.state](y.type)),1)]),_:2},1024)):q("",!0)]),k("span",{class:"ml-8 lighter",style:Et({color:[s(v).FAILURE,s(v).REVOKED].includes(y.state)?"#F54A45":""})},n(E.$t("views.document.fileStatus.finish"))+" "+n(Object.keys(y.aggs?y.aggs:{}).filter($=>$==s(v).SUCCESS).map($=>y.aggs[$]).reduce(($,C)=>$+C,0))+"/"+n(Object.values(y.aggs?y.aggs:{}).reduce(($,C)=>$+C,0)),5),l(M,{type:"info",class:"ml-12"},{default:e(()=>{var $;return[o(n(y.time?($=y.time[y.state==s(v).REVOKED?s(v).REVOKED:s(v).PENDING])==null?void 0:$.substring(0,19):void 0),1)]}),_:2},1024)]))),128)}}}),Ht=re({__name:"Status",props:{status:{},statusMeta:{}},setup(P){const b=P,T=R(!1),S=[v.REVOKE,v.STARTED,v.PENDING,v.FAILURE,v.REVOKED,v.SUCCESS],h=fe(()=>{let f={key:0,value:""};for(const i in S){const M=S[i],G=b.status.indexOf(M);if(G>-1){f={key:b.status.length-G,value:M};break}}return f}),K={[A.EMBEDDING]:r("views.document.fileStatus.EMBEDDING"),[A.GENERATE_PROBLEM]:r("views.document.fileStatus.GENERATE"),[A.SYNC]:r("views.document.fileStatus.SYNC")},E={[A.EMBEDDING]:r("views.dataset.setting.vectorization"),[A.GENERATE_PROBLEM]:r("views.document.generateQuestion.title"),[A.SYNC]:r("views.dataset.setting.sync")},g={[v.PENDING]:f=>r("views.document.fileStatus.PENDING"),[v.STARTED]:f=>K[f],[v.REVOKE]:f=>r("views.document.fileStatus.REVOKE"),[v.REVOKED]:f=>r("views.document.fileStatus.SUCCESS"),[v.FAILURE]:f=>r("views.document.fileStatus.FAILURE"),[v.SUCCESS]:f=>r("views.document.fileStatus.SUCCESS")};return(f,i)=>{const M=u("SuccessFilled"),G=u("el-icon"),D=u("el-text"),y=u("CircleCloseFilled"),$=u("Loading"),C=u("el-popover");return m(),_(C,{visible:T.value,"onUpdate:visible":i[0]||(i[0]=U=>T.value=U),placement:"top",trigger:"hover","popper-style":{width:"auto"}},{default:e(()=>[T.value?(m(),_(Kt,{key:0,status:f.status,statusMeta:f.statusMeta,taskTypeMap:E,stateMap:g},null,8,["status","statusMeta"])):q("",!0)]),reference:e(()=>{var U,p,w,I,z,Y;return[((U=h.value)==null?void 0:U.value)===s(v).SUCCESS||((p=h.value)==null?void 0:p.value)===s(v).REVOKED?(m(),_(D,{key:0},{default:e(()=>[l(G,{class:"success"},{default:e(()=>[l(M)]),_:1}),o(" "+n(g[h.value.value](h.value.key)),1)]),_:1})):((w=h.value)==null?void 0:w.value)===s(v).FAILURE?(m(),_(D,{key:1},{default:e(()=>[l(G,{class:"danger"},{default:e(()=>[l(y)]),_:1}),o(" "+n(g[h.value.value](h.value.key)),1)]),_:1})):((I=h.value)==null?void 0:I.value)===s(v).STARTED?(m(),_(D,{key:2},{default:e(()=>[l(G,{class:"is-loading primary"},{default:e(()=>[l($)]),_:1}),o(" "+n(g[h.value.value](h.value.key)),1)]),_:1})):((z=h.value)==null?void 0:z.value)===s(v).PENDING?(m(),_(D,{key:3},{default:e(()=>[l(G,{class:"is-loading primary"},{default:e(()=>[l($)]),_:1}),o(" "+n(g[h.value.value](h.value.key)),1)]),_:1})):((Y=h.value)==null?void 0:Y.value)===s(v).REVOKE?(m(),_(D,{key:4},{default:e(()=>[l(G,{class:"is-loading primary"},{default:e(()=>[l($)]),_:1}),o(" "+n(g[h.value.value](h.value.key)),1)]),_:1})):q("",!0)]}),_:1},8,["visible"])}}}),Wt={class:"dialog-footer"},Qt=re({__name:"EmbeddingContentDialog",setup(P,{expose:b}){const T=R(!1),S=R("error"),h={all:["0","1","2","3","4","5","n"],error:["0","1","3","4","5","n"]},K=R(),E=()=>{K.value&&K.value(h[S.value]),f()},g=i=>{K.value=i,T.value=!0},f=()=>{K.value=void 0,T.value=!1};return b({open:g,close:f}),(i,M)=>{const G=u("el-radio"),D=u("el-radio-group"),y=u("el-button"),$=u("el-dialog");return m(),_($,{modelValue:T.value,"onUpdate:modelValue":M[1]||(M[1]=C=>T.value=C),title:i.$t("components.selectParagraph.title"),"before-close":f,width:"450"},{footer:e(()=>[k("div",Wt,[l(y,{onClick:f},{default:e(()=>[o(n(i.$t("common.cancel")),1)]),_:1}),l(y,{type:"primary",onClick:E},{default:e(()=>[o(n(i.$t("common.submit")),1)]),_:1})])]),default:e(()=>[l(D,{modelValue:S.value,"onUpdate:modelValue":M[0]||(M[0]=C=>S.value=C),class:"radio-block"},{default:e(()=>[l(G,{value:"error",size:"large"},{default:e(()=>[o(n(i.$t("components.selectParagraph.error")),1)]),_:1}),l(G,{value:"all",size:"large"},{default:e(()=>[o(n(i.$t("components.selectParagraph.all")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),Yt={class:"main-calc-height"},Zt={class:"p-24"},Jt={class:"flex-between"},Xt={key:0},xt={class:"mr-4"},el={class:"mr-4"},tl={key:1},ll={class:"mr-4"},nl={class:"mr-4"},al={key:0,class:"mul-operation w-full flex"},ne="documents",ol=re({__name:"index",setup(P){const b=bt(),T=Ce(),{params:{id:S}}=T,{common:h,dataset:K,document:E}=Le(),g=(t,a)=>{const d=t.split("").reverse();return a-1>d.length+1?"n":d[a-1]};$t(()=>{h.savePage(ne,null),h.saveCondition(ne,null)}),Ct(t=>{t.name!=="Paragraph"?(h.savePage(ne,null),h.saveCondition(ne,null)):h.saveCondition(ne,{filterText:$.value,filterMethod:C.value})});const f=fe(()=>h.paginationConfig[ne]),i=fe(()=>h.search[ne]),M=R(),G=R(),D=R(!1);let y;const $=R(""),C=R({}),U=R(""),p=R([]),w=R(null),I=R({}),z=R({current_page:1,page_size:10,total:0}),Y=R(),ee=R(),B=R([]),le=R(""),ie=R(),ue=t=>{j.exportDocument(t.name,t.dataset_id,t.id,D).then(()=>{Q(r("common.exportSuccess"))})},oe=t=>{j.exportDocumentZip(t.name,t.dataset_id,t.id,D).then(()=>{Q(r("common.exportSuccess"))})};function ce(t){const a=[];B.value.map(H=>{H&&a.push(H.id)});const d={id_list:a,type:t};j.batchCancelTask(S,d,D).then(()=>{var H;Q(r("views.document.tip.cancelSuccess")),(H=ee.value)==null||H.clearSelection()})}function O(){var t;(t=ee.value)==null||t.clearSelection()}function N(t){const a=[];t?a.push(t.id):B.value.map(d=>{d&&a.push(d.id)}),ie.value.open(a)}function se(t){C.value[t.attr]=t.command,t.attr=="status"&&(C.value.task_type=t.task_type),F()}function X(t,a,d){return{attr:t,command:a,task_type:d}}const _e=(t,a)=>{j.cancelTask(t.dataset_id,t.id,{type:a}).then(()=>{Q(r("views.document.tip.sendMessage"))})};function ze(){le.value=r("views.document.importDocument"),Y.value.open()}function De(t){le.value=r("common.setting"),Y.value.open(t)}const Oe=t=>{B.value=t};function Fe(){le.value=r("common.setting");const t=B.value.map(a=>a.id);Y.value.open(null,t)}const je=()=>{y=setInterval(()=>{F(!0)},6e3)},qe=()=>{y&&clearInterval(y)};function Ke(t){console.log("row",t),t.type==="1"?We(t):He(t)}function He(t){ve(r("views.document.sync.confirmTitle"),r("views.document.sync.confirmMessage1"),{confirmButtonText:r("views.document.sync.label"),confirmButtonClass:"danger"}).then(()=>{j.putLarkDocumentSync(S,t.id).then(()=>{F()})}).catch(()=>{})}function We(t){var a;(a=t.meta)!=null&&a.source_url?ve(r("views.document.sync.confirmTitle"),r("views.document.sync.confirmMessage1"),{confirmButtonText:r("views.document.sync.label"),confirmButtonClass:"danger"}).then(()=>{j.putDocumentSync(t.dataset_id,t.id).then(()=>{F()})}).catch(()=>{}):ve(r("common.tip"),r("views.document.sync.confirmMessage2"),{confirmButtonText:r("common.confirm"),type:"warning"}).then(()=>{}).catch(()=>{})}function Se(t){var d;const a=H=>j.putDocumentRefresh(t.dataset_id,t.id,H).then(()=>{F()});(d=M.value)==null||d.open(a)}function Qe(t,a){a&&a.type==="selection"||b.push({path:`/dataset/${S}/${t.id}`})}function Ye(t){D.value=!0;const a=[{name:t}];E.asyncPostDocument(S,a).then(()=>{F(),Q(r("common.createSuccess"))}).catch(()=>{D.value=!1})}function Ze(){const t=[];B.value.map(a=>{a&&t.push(a.id)}),j.delMulSyncDocument(S,t,D).then(()=>{Q(r("views.document.sync.successMessage")),F()})}function Je(){const t=[];B.value.map(a=>{a&&t.push(a.id)}),j.delMulLarkSyncDocument(S,t,D).then(()=>{Q(r("views.document.sync.successMessage")),F()})}function Xe(){ve(`${r("views.document.delete.confirmTitle1")} ${B.value.length} ${r("views.document.delete.confirmTitle2")}`,r("views.document.delete.confirmMessage"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{const t=[];B.value.map(a=>{a&&t.push(a.id)}),j.delMulDocument(S,t,D).then(()=>{var a;Q(r("views.document.delete.successMessage")),(a=ee.value)==null||a.clearSelection(),F()})}).catch(()=>{})}function xe(){var d;const t=B.value.map(H=>H.id),a=H=>{j.batchRefresh(S,t,H,D).then(()=>{var W;Q(r("views.document.tip.vectorizationSuccess")),(W=ee.value)==null||W.clearSelection()})};(d=M.value)==null||d.open(a)}function we(t){ve(`${r("views.document.delete.confirmTitle3")} ${t.name} ?`,`${r("views.document.delete.confirmMessage1")} ${t.paragraph_count} ${r("views.document.delete.confirmMessage2")}`,{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{j.delDocument(S,t.id,D).then(()=>{Q(r("common.deleteSuccess")),F()})}).catch(()=>{})}function Re(t,a,d){j.putDocument(S,t,a,D).then(H=>{const W=p.value.findIndex(be=>be.id===t);return p.value.splice(W,1,H.data),Q(d),!0}).catch(()=>!1)}function et(t){const a={is_active:!t.is_active},d=t.is_active?r("common.status.disableSuccess"):r("common.status.enableSuccess");w.value&&Re(t.id,a,d)}function tt(t,a){t?Re(a,{name:t},r("common.modifySuccess")):Rt(r("views.document.tip.nameMessage"))}function lt(t){w.value=t.id}function nt(){w.value=null}function at(){z.value.current_page=1,F()}function ot({prop:t,order:a}){U.value=a==="ascending"?t:`-${t}`,F()}function F(t){const a={...$.value&&{name:$.value},...C.value,order_by:U.value};j.getDocument(S,z.value,a,t?void 0:D).then(d=>{p.value=d.data.records,z.value.total=d.data.total})}function st(){K.asyncGetDatasetDetail(S,D).then(t=>{I.value=t.data})}function it(){var t;(t=ee.value)==null||t.clearSelection(),F()}function Me(){z.value.current_page=1,F()}const Ne=R();function Ee(t){const a=[];t?a.push(t.id):B.value.map(d=>{d&&a.push(d.id)}),Ne.value.open(a,"document")}return Dt(()=>{st(),f.value&&(z.value=f.value),i.value&&($.value=i.value.filterText,C.value=i.value.filterMethod),F(),je()}),St(()=>{qe()}),(t,a)=>{const d=u("el-button"),H=u("el-input"),W=u("el-table-column"),be=u("ReadWrite"),$e=u("Filter"),x=u("el-icon"),L=u("el-dropdown-item"),me=u("el-dropdown-menu"),pe=u("el-dropdown"),ut=u("el-switch"),te=u("AppIcon"),de=u("el-tooltip"),ct=u("Setting"),Te=u("MoreFilled"),ge=u("Connection"),dt=u("Refresh"),rt=u("app-table"),mt=u("el-text"),pt=u("LayoutContainer"),vt=Ue("loading");return m(),_(pt,{header:t.$t("common.fileUpload.document"),class:"document-main"},{default:e(()=>[k("div",Yt,[k("div",Zt,[k("div",Jt,[k("div",null,[I.value.type==="0"?(m(),_(d,{key:0,type:"primary",onClick:a[0]||(a[0]=c=>s(b).push({path:"/dataset/upload",query:{id:s(S)}}))},{default:e(()=>[o(n(t.$t("views.document.uploadDocument")),1)]),_:1})):q("",!0),I.value.type==="1"?(m(),_(d,{key:1,type:"primary",onClick:ze},{default:e(()=>[o(n(t.$t("views.document.importDocument")),1)]),_:1})):q("",!0),I.value.type==="1"?(m(),_(d,{key:2,onClick:Ze,disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("views.document.syncDocument")),1)]),_:1},8,["disabled"])):q("",!0),I.value.type==="2"?(m(),_(d,{key:3,type:"primary",onClick:a[1]||(a[1]=c=>s(b).push({path:"/dataset/import",query:{id:s(S),folder_token:I.value.meta.folder_token}}))},{default:e(()=>[o(n(t.$t("views.document.importDocument")),1)]),_:1})):q("",!0),I.value.type==="2"?(m(),_(d,{key:4,onClick:Je,disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("views.document.syncDocument")),1)]),_:1},8,["disabled"])):q("",!0),l(d,{onClick:a[2]||(a[2]=c=>N()),disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(d,{onClick:xe,disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("views.dataset.setting.vectorization")),1)]),_:1},8,["disabled"]),l(d,{onClick:a[3]||(a[3]=c=>Ee()),disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(d,{onClick:Fe,disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("common.setting")),1)]),_:1},8,["disabled"]),l(d,{onClick:Xe,disabled:B.value.length===0},{default:e(()=>[o(n(t.$t("common.delete")),1)]),_:1},8,["disabled"])]),l(H,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=c=>$.value=c),placeholder:t.$t("views.document.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:F,clearable:""},null,8,["modelValue","placeholder"])]),Pe((m(),_(rt,{ref_key:"multipleTableRef",ref:ee,class:"mt-16",data:p.value,"pagination-config":z.value,"quick-create":I.value.type==="0",onSizeChange:at,onChangePage:F,onCellMouseEnter:lt,onCellMouseLeave:nt,onCreatQuick:Ye,onRowClick:Qe,onSelectionChange:Oe,onSortChange:ot,"row-key":c=>c.id,storeKey:ne},{default:e(()=>[l(W,{type:"selection",width:"55","reserve-selection":!0}),l(W,{prop:"name",label:t.$t("views.document.table.name"),"min-width":"280"},{default:e(({row:c})=>[l(be,{onChange:V=>tt(V,c.id),data:c.name,showEditIcon:c.id===w.value},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),l(W,{prop:"char_length",label:t.$t("views.document.table.char_length"),align:"right","min-width":"90",sortable:""},{default:e(({row:c})=>[o(n(s(wt)(c.char_length)),1)]),_:1},8,["label"]),l(W,{prop:"paragraph_count",label:t.$t("views.document.table.paragraph"),align:"right","min-width":"90",sortable:""},null,8,["label"]),l(W,{prop:"status",label:t.$t("views.document.fileStatus.label"),width:"130"},{header:e(()=>[k("div",null,[k("span",null,n(t.$t("views.document.fileStatus.label")),1),l(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[l(me,{style:{width:"100px"}},{default:e(()=>[l(L,{class:J([C.value.status?"":"is-active","justify-center"]),command:X("status","")},{default:e(()=>[o(n(t.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.status===s(v).SUCCESS?"is-active":"","justify-center"]),command:X("status",s(v).SUCCESS)},{default:e(()=>[o(n(t.$t("views.document.fileStatus.SUCCESS")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.status===s(v).FAILURE?"is-active":"","justify-center"]),command:X("status",s(v).FAILURE)},{default:e(()=>[o(n(t.$t("views.document.fileStatus.FAILURE")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.status===s(v).STARTED&&C.value.task_type==s(A).EMBEDDING?"is-active":"","justify-center"]),command:X("status",s(v).STARTED,s(A).EMBEDDING)},{default:e(()=>[o(n(t.$t("views.document.fileStatus.EMBEDDING")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.status===s(v).PENDING?"is-active":"","justify-center"]),command:X("status",s(v).PENDING)},{default:e(()=>[o(n(t.$t("views.document.fileStatus.PENDING")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.status===s(v).STARTED&&C.value.task_type===s(A).GENERATE_PROBLEM?"is-active":"","justify-center"]),command:X("status",s(v).STARTED,s(A).GENERATE_PROBLEM)},{default:e(()=>[o(n(t.$t("views.document.fileStatus.GENERATE")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[l(d,{style:{"margin-top":"1px"},link:"",type:C.value.status?"primary":""},{default:e(()=>[l(x,null,{default:e(()=>[l($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[l(Ht,{status:c.status,"status-meta":c.status_meta},null,8,["status","status-meta"])]),_:1},8,["label"]),l(W,{width:"130"},{header:e(()=>[k("div",null,[k("span",null,n(t.$t("views.document.enableStatus.label")),1),l(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[l(me,{style:{width:"100px"}},{default:e(()=>[l(L,{class:J([C.value.is_active===""?"is-active":"","justify-center"]),command:X("is_active","")},{default:e(()=>[o(n(t.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.is_active===!0?"is-active":"","justify-center"]),command:X("is_active",!0)},{default:e(()=>[o(n(t.$t("views.document.enableStatus.enable")),1)]),_:1},8,["class","command"]),l(L,{class:J([C.value.is_active===!1?"is-active":"","justify-center"]),command:X("is_active",!1)},{default:e(()=>[o(n(t.$t("views.document.enableStatus.close")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[l(d,{style:{"margin-top":"1px"},link:"",type:C.value.is_active?"primary":""},{default:e(()=>[l(x,null,{default:e(()=>[l($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[k("div",{onClick:a[5]||(a[5]=Z(()=>{},["stop"]))},[l(ut,{loading:D.value,size:"small",modelValue:c.is_active,"onUpdate:modelValue":V=>c.is_active=V,"before-change":()=>et(c)},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:1}),l(W,{width:"170"},{header:e(()=>[k("div",null,[k("span",null,n(t.$t("views.document.form.hit_handling_method.label")),1),l(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[l(me,{style:{width:"150px"}},{default:e(()=>[l(L,{class:J([C.value.hit_handling_method?"":"is-active","justify-center"]),command:X("hit_handling_method","")},{default:e(()=>[o(n(t.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),(m(!0),ae(he,null,ke(s(ye),(c,V)=>(m(),_(L,{key:V,class:J([C.value.hit_handling_method===V?"is-active":"","justify-center"]),command:X("hit_handling_method",V)},{default:e(()=>[o(n(t.$t(c)),1)]),_:2},1032,["class","command"]))),128))]),_:1})]),default:e(()=>[l(d,{style:{"margin-top":"1px"},link:"",type:C.value.hit_handling_method?"primary":""},{default:e(()=>[l(x,null,{default:e(()=>[l($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[o(n(t.$t(s(ye)[c.hit_handling_method])),1)]),_:1}),l(W,{prop:"create_time",label:t.$t("common.createTime"),width:"175",sortable:""},{default:e(({row:c})=>[o(n(s(Ae)(c.create_time)),1)]),_:1},8,["label"]),l(W,{prop:"update_time",label:t.$t("views.document.table.updateTime"),width:"175",sortable:""},{default:e(({row:c})=>[o(n(s(Ae)(c.update_time)),1)]),_:1},8,["label"]),l(W,{label:t.$t("common.operation"),align:"left",width:"110",fixed:"right"},{default:e(({row:c})=>[I.value.type==="0"?(m(),ae("div",Xt,[k("span",xt,[[s(v).STARTED,s(v).PENDING].includes(g(c.status,s(A).EMBEDDING))?(m(),_(de,{key:0,effect:"dark",content:t.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>_e(c,s(A).EMBEDDING),["stop"])},{default:e(()=>[l(te,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(m(),_(de,{key:1,effect:"dark",content:t.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>Se(c),["stop"])},{default:e(()=>[l(te,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),k("span",el,[l(de,{effect:"dark",content:t.$t("common.setting"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>De(c),["stop"])},{default:e(()=>[l(x,null,{default:e(()=>[l(ct)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),k("span",{onClick:a[6]||(a[6]=Z(()=>{},["stop"]))},[l(pe,{trigger:"click"},{dropdown:e(()=>[l(me,null,{default:e(()=>[[s(v).STARTED,s(v).PENDING].includes(g(c.status,s(A).GENERATE_PROBLEM))?(m(),_(L,{key:0,onClick:V=>_e(c,s(A).GENERATE_PROBLEM)},{default:e(()=>[l(x,null,{default:e(()=>[l(ge)]),_:1}),o(" "+n(t.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(m(),_(L,{key:1,onClick:V=>Ee(c)},{default:e(()=>[l(x,null,{default:e(()=>[l(ge)]),_:1}),o(" "+n(t.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),l(L,{onClick:V=>N(c)},{default:e(()=>[l(te,{iconName:"app-migrate"}),o(" "+n(t.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(L,{onClick:V=>ue(c)},{default:e(()=>[l(te,{iconName:"app-export"}),o(" "+n(t.$t("views.document.setting.export"))+" Excel ",1)]),_:2},1032,["onClick"]),l(L,{onClick:V=>oe(c)},{default:e(()=>[l(te,{iconName:"app-export"}),o(" "+n(t.$t("views.document.setting.export"))+" Zip ",1)]),_:2},1032,["onClick"]),l(L,{icon:"Delete",onClick:Z(V=>we(c),["stop"])},{default:e(()=>[o(n(t.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[l(d,{text:"",type:"primary"},{default:e(()=>[l(x,null,{default:e(()=>[l(Te)]),_:1})]),_:1})]),_:2},1024)])])):q("",!0),I.value.type==="1"||I.value.type==="2"?(m(),ae("div",tl,[k("span",ll,[l(de,{effect:"dark",content:t.$t("views.dataset.setting.sync"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>Ke(c),["stop"])},{default:e(()=>[l(x,null,{default:e(()=>[l(dt)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),k("span",nl,[[s(v).STARTED,s(v).PENDING].includes(g(c.status,s(A).EMBEDDING))?(m(),_(de,{key:0,effect:"dark",content:t.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>_e(c,s(A).EMBEDDING),["stop"])},{default:e(()=>[l(te,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(m(),_(de,{key:1,effect:"dark",content:t.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[l(d,{type:"primary",text:"",onClick:Z(V=>Se(c),["stop"])},{default:e(()=>[l(te,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),k("span",{onClick:a[7]||(a[7]=Z(()=>{},["stop"]))},[l(pe,{trigger:"click"},{dropdown:e(()=>[l(me,null,{default:e(()=>[l(L,{icon:"Setting",onClick:V=>De(c)},{default:e(()=>[o(n(t.$t("common.setting")),1)]),_:2},1032,["onClick"]),[s(v).STARTED,s(v).PENDING].includes(g(c.status,s(A).GENERATE_PROBLEM))?(m(),_(L,{key:0,onClick:V=>_e(c,s(A).GENERATE_PROBLEM)},{default:e(()=>[l(x,null,{default:e(()=>[l(ge)]),_:1}),o(" "+n(t.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(m(),_(L,{key:1,onClick:V=>Ee(c)},{default:e(()=>[l(x,null,{default:e(()=>[l(ge)]),_:1}),o(" "+n(t.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),l(L,{onClick:V=>N(c)},{default:e(()=>[l(te,{iconName:"app-migrate"}),o(" "+n(t.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(L,{onClick:V=>ue(c)},{default:e(()=>[l(te,{iconName:"app-export"}),o(" "+n(t.$t("views.document.setting.export"))+" Excel ",1)]),_:2},1032,["onClick"]),l(L,{onClick:V=>oe(c)},{default:e(()=>[l(te,{iconName:"app-export"}),o(" "+n(t.$t("views.document.setting.export"))+" Zip ",1)]),_:2},1032,["onClick"]),l(L,{icon:"Delete",onClick:Z(V=>we(c),["stop"])},{default:e(()=>[o(n(t.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[l(d,{text:"",type:"primary"},{default:e(()=>[l(x,null,{default:e(()=>[l(Te)]),_:1})]),_:1})]),_:2},1024)])])):q("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quick-create","row-key"])),[[vt,D.value]])]),l(Bt,{ref_key:"ImportDocumentDialogRef",ref:Y,title:le.value,onRefresh:Me},null,8,["title"]),l(Nt,{ref_key:"SyncWebDialogRef",ref:G,onRefresh:Me},null,512),l(qt,{ref_key:"SelectDatasetDialogRef",ref:ie,onRefresh:it},null,512),l(Tt,{ref_key:"GenerateRelatedDialogRef",ref:Ne,onRefresh:F},null,512)]),B.value.length!==0?(m(),ae("div",al,[l(d,{disabled:B.value.length===0,onClick:a[8]||(a[8]=c=>ce(1))},{default:e(()=>[o(n(t.$t("views.document.setting.cancelVectorization")),1)]),_:1},8,["disabled"]),l(d,{disabled:B.value.length===0,onClick:a[9]||(a[9]=c=>ce(2))},{default:e(()=>[o(n(t.$t("views.document.setting.cancelGenerate")),1)]),_:1},8,["disabled"]),l(mt,{type:"info",class:"secondary ml-24"},{default:e(()=>[o(n(t.$t("views.document.selected"))+" "+n(B.value.length)+" "+n(t.$t("views.document.items")),1)]),_:1}),l(d,{class:"ml-16",type:"primary",link:"",onClick:O},{default:e(()=>[o(n(t.$t("common.clear")),1)]),_:1})])):q("",!0),l(Qt,{ref_key:"embeddingContentDialogRef",ref:M},null,512)]),_:1},8,["header"])}}});const dl=Mt(ol,[["__scopeId","data-v-038a1da6"]]);export{dl as default};
