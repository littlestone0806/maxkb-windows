import{cp as ne,dv as le,d1 as ie,cZ as s,cq as _,d3 as pe,d0 as Ve,cu as l,cx as f,cF as C,cA as n,cB as y,cz as a,cE as I,cK as b,cJ as v,cT as Ie,dV as se,dW as ce,dX as Fe,cQ as B,dh as re,cP as Y,ct as De,cU as Ue,cy as z,cC as oe,cD as ae,cv as Ne,cH as J,dy as Se,cN as te,dY as Be,cY as Te,c_ as W,cR as Me}from"./index-1a322249.js";const Pe={class:"dialog-footer"},Re=ne({__name:"CopyApplicationDialog",setup(de,{expose:M}){const F=le(),{common:g,user:q}=ie(),D=s("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),U=_(),x=_(!1),u=_(!1),d=_({name:"",desc:"",model_id:"",dialogue_number:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:D},problem_optimization:!1,type:"SIMPLE"}),h=pe({name:[{required:!0,message:s("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]});Ve(u,c=>{var i;c||(d.value={name:"",desc:"",model_id:"",dialogue_number:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:D},problem_optimization:!1,type:"SIMPLE"},(i=U.value)==null||i.clearValidate())});const N=c=>{const i=Ie.cloneDeep(c);delete i.id,i.name=i.name+` ${s("views.application.applicationForm.title.copy")}`,d.value=i,u.value=!0},k=c=>{q.isEnterprise()?A(c):g.asyncGetValid(se.Application,ce.Application,x).then(async i=>{i!=null&&i.data?A(c):Fe(s("common.tip"),s("views.application.tip.professionalMessage"))})},A=async c=>{c&&await c.validate(i=>{i&&B.postApplication(d.value,x).then($=>{re(s("common.createSuccess")),Y(d.value.type)?F.push({path:`/application/${$.data.id}/workflow`}):F.push({path:`/application/${$.data.id}/${$.data.type}/setting`}),u.value=!1})})};return M({open:N}),(c,i)=>{const $=l("el-input"),P=l("el-form-item"),L=l("el-form"),R=l("el-button"),E=l("el-dialog");return f(),C(E,{title:c.$t("views.application.copyApplication"),modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=w=>u.value=w),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[y("span",Pe,[a(R,{onClick:i[2]||(i[2]=I(w=>u.value=!1,["prevent"])),loading:x.value},{default:n(()=>[b(v(c.$t("common.cancel")),1)]),_:1},8,["loading"]),a(R,{type:"primary",onClick:i[3]||(i[3]=w=>k(U.value)),loading:x.value},{default:n(()=>[b(v(c.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:n(()=>[a(L,{ref_key:"applicationFormRef",ref:U,model:d.value,rules:h,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(P,{label:c.$t("views.application.applicationForm.form.appName.label"),prop:"name"},{default:n(()=>[a($,{modelValue:d.value.name,"onUpdate:modelValue":i[0]||(i[0]=w=>d.value.name=w),maxlength:"64",placeholder:c.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(P,{label:c.$t("views.application.applicationForm.form.appDescription.label")},{default:n(()=>[a($,{modelValue:d.value.desc,"onUpdate:modelValue":i[1]||(i[1]=w=>d.value.desc=w),type:"textarea",placeholder:c.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),ze={class:"application-list-container p-24",style:{"padding-top":"16px"}},qe={class:"flex-between mb-16"},Le={class:"flex-between"},Ee={class:"flex align-center cursor p-8"},Ge=["src"],He={class:"status-tag"},Oe={class:"footer-content"},Je=ne({__name:"index",setup(de){const M=_(),{application:F,user:g,common:q}=ie(),D=le(),U=_(),x=_(),u=_(!1),d=_([]),h=pe({current_page:1,page_size:30,total:0}),N=_([]),k=_("all"),A=_(""),c=_([]);function i(e){F.asyncGetApplicationDetail(e.id,u).then(o=>{o!=null&&o.data&&U.value.open({...o.data,model_id:o.data.model})})}const $=e=>g.userInfo?g.userInfo.id==e.user_id:!1;function P(e){Y(e.type)?D.push({path:`/application/${e.id}/workflow`}):D.push({path:`/application/${e.id}/${e.type}/setting`})}const L=e=>{B.exportApplication(e.id,e.name,u).catch(o=>{o.response.status!==403&&o.response.data.text().then(p=>{Te(`${s("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},R=e=>{const o=new FormData;o.append("file",e.raw,e.name),M.value.clearFiles(),B.importApplication(o,u).then(async p=>{p!=null&&p.data&&w()}).catch(p=>{p.code===400&&W(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})};function E(){q.asyncGetValid(se.Application,ce.Application,u).then(async e=>{e!=null&&e.data?x.value.open():(e==null?void 0:e.code)===400&&W(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})}function w(){g.userInfo&&localStorage.setItem(g.userInfo.id+"application",k.value),d.value=[],h.current_page=1,h.total=0,G()}function j(e){const o=new URLSearchParams;return e.forEach(p=>{o.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),o.toString()}function ue(e){var p,V,S;(S=(V=(p=d.value.filter(r=>r.id===e)[0])==null?void 0:p.work_flow)==null?void 0:V.nodes)==null||S.filter(r=>r.id==="base-node").map(r=>{c.value=r.properties.api_input_field_list?r.properties.api_input_field_list.map(m=>({name:m.variable,value:m.default_value})):r.properties.input_field_list?r.properties.input_field_list.filter(m=>m.assignment_method==="api_input").map(m=>({name:m.variable,value:m.default_value})):[]});const o=j(c.value)?"?"+j(c.value):"";F.asyncGetAccessToken(e,u).then(r=>{var m;window.open(F.location+((m=r==null?void 0:r.data)==null?void 0:m.access_token)+o)})}function me(e){W(`${s("views.application.delete.confirmTitle")}${e.name} ?`,s("views.application.delete.confirmMessage"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),confirmButtonClass:"danger"}).then(()=>{B.delApplication(e.id,u).then(()=>{const o=d.value.findIndex(p=>p.id===e.id);d.value.splice(o,1),re(s("common.deleteSuccess"))})}).catch(()=>{})}function G(){const e={...A.value&&{name:A.value},...k.value&&k.value!=="all"&&{select_user_id:k.value}};B.getApplication(h,e,u).then(o=>{o.data.records.forEach(p=>{var V;g.userInfo&&p.user_id===g.userInfo.id?p.username=g.userInfo.username:p.username=(V=N.value.find(S=>S.value===p.user_id))==null?void 0:V.label}),d.value=[...d.value,...o.data.records],h.total=o.data.total})}function _e(){B.getUserList("APPLICATION",u).then(e=>{if(e.data){if(N.value=e.data.map(o=>({label:o.username,value:o.id})),g.userInfo){const o=localStorage.getItem(g.userInfo.id+"application");o&&N.value.find(p=>p.value===o)&&(k.value=o)}G()}})}return De(()=>{_e()}),(e,o)=>{const p=l("el-option"),V=l("el-select"),S=l("el-input"),r=l("AppIcon"),m=l("el-divider"),fe=l("el-upload"),ve=l("el-card"),K=l("el-col"),Q=l("AppAvatar"),ge=l("auto-tooltip"),he=l("el-text"),X=l("el-tag"),H=l("el-button"),Z=l("el-tooltip"),we=l("MoreFilled"),ye=l("el-icon"),O=l("el-dropdown-item"),be=l("el-dropdown-menu"),ke=l("el-dropdown"),$e=l("CardBox"),Ce=l("el-row"),xe=l("InfiniteScroll"),Ae=Ue("loading");return f(),z("div",ze,[y("div",qe,[y("h4",null,v(e.$t("views.application.title")),1),y("div",Le,[a(V,{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=t=>k.value=t),class:"mr-12",onChange:w,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(f(!0),z(oe,null,ae(N.value,t=>(f(),C(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(S,{modelValue:A.value,"onUpdate:modelValue":o[1]||(o[1]=t=>A.value=t),onChange:w,placeholder:e.$t("views.application.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"min-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),Ne((f(),z("div",null,[a(xe,{size:d.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":o[5]||(o[5]=t=>h.current_page=t),onLoad:G,loading:u.value},{default:n(()=>[a(Ce,{gutter:15},{default:n(()=>[a(K,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[a(ve,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:n(()=>[y("div",{class:"card-add-button flex align-center cursor p-8",onClick:E},[a(r,{iconName:"app-add-application",class:"mr-8"}),b(" "+v(e.$t("views.application.createApplication")),1)]),a(m,{style:{margin:"8px 0"}}),a(fe,{ref_key:"elUploadRef",ref:M,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(t,ee)=>R(t),class:"card-add-button"},{default:n(()=>[y("div",Ee,[a(r,{iconName:"app-import",class:"mr-8"}),b(" "+v(e.$t("views.application.importApplication")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(f(!0),z(oe,null,ae(d.value,(t,ee)=>(f(),C(K,{xs:24,sm:12,md:8,lg:6,xl:6,key:ee,class:"mb-16"},{default:n(()=>[a($e,{title:t.name,description:t.desc,class:"application-card cursor",onClick:T=>J(D).push({path:`/application/${t.id}/${t.type}/overview`})},{icon:n(()=>[J(Se)(t==null?void 0:t.icon)?(f(),C(Q,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:n(()=>[y("img",{src:t==null?void 0:t.icon,alt:""},null,8,Ge)]),_:2},1024)):t!=null&&t.name?(f(),C(Q,{key:1,name:t==null?void 0:t.name,pinyinColor:"",shape:"square",size:32,class:"mr-8"},null,8,["name"])):te("",!0)]),subTitle:n(()=>[a(he,{class:"color-secondary",size:"small"},{default:n(()=>[a(ge,{content:t.username},{default:n(()=>[b(v(e.$t("common.creator"))+": "+v(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[y("div",Oe,[a(Z,{effect:"dark",content:e.$t("views.application.setting.demo"),placement:"top"},{default:n(()=>[a(H,{text:"",onClick:[o[2]||(o[2]=I(()=>{},["stop"])),T=>ue(t.id)]},{default:n(()=>[a(r,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),a(m,{direction:"vertical"}),a(Z,{effect:"dark",content:e.$t("common.setting"),placement:"top"},{default:n(()=>[a(H,{text:"",onClick:I(T=>P(t),["stop"])},{default:n(()=>[a(r,{iconName:"Setting"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),a(m,{direction:"vertical"}),y("span",{onClick:o[4]||(o[4]=I(()=>{},["stop"]))},[a(ke,{trigger:"click"},{dropdown:n(()=>[a(be,null,{default:n(()=>[$(t)?(f(),C(O,{key:0,onClick:T=>i(t)},{default:n(()=>[a(r,{iconName:"app-copy"}),b(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):te("",!0),a(O,{onClick:I(T=>L(t),["stop"])},{default:n(()=>[a(r,{iconName:"app-export"}),b(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"]),a(O,{icon:"Delete",onClick:I(T=>me(t),["stop"])},{default:n(()=>[b(v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[a(H,{text:"",onClick:o[3]||(o[3]=I(()=>{},["stop"]))},{default:n(()=>[a(ye,null,{default:n(()=>[a(we)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[y("div",He,[J(Y)(t.type)?(f(),C(X,{key:0,type:"warning",style:{height:"22px"}},{default:n(()=>[b(v(e.$t("views.application.workflow")),1)]),_:1})):(f(),C(X,{key:1,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[b(v(e.$t("views.application.simple")),1)]),_:1}))])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Ae,h.current_page===1&&u.value,void 0,{fullscreen:!0,lock:!0}]]),a(Be,{ref_key:"CreateApplicationDialogRef",ref:x},null,512),a(Re,{ref_key:"CopyApplicationDialogRef",ref:U},null,512)])}}});const Ye=Me(Je,[["__scopeId","data-v-bb93e491"]]);export{Ye as default};
