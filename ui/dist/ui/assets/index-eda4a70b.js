import{cp as fe,d1 as me,dv as ve,cq as m,d3 as ge,ct as he,cu as s,cU as ye,cx as i,cy as I,cB as d,cJ as l,cz as o,cA as n,cC as F,cD as G,cF as p,cv as ke,cH as M,dp as we,dq as Ce,dr as $e,cK as c,e5 as xe,cE as v,cN as W,ek as be,dV as De,dW as Se,c_ as Z,cZ as r,dh as C,ed as $,cQ as Ie,cR as Ve}from"./index-1a322249.js";import{S as ze}from"./SyncWebDialog-88f2a427.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-50be941a.js";const Re={class:"dataset-list-container p-24",style:{"padding-top":"16px"}},Be={class:"flex-between mb-16"},Me={class:"flex-between"},Te={class:"delete-button"},Ne={class:"footer-content flex-between"},Ue={class:"bold"},Ee={class:"bold"},qe={class:"bold"},Le=fe({__name:"index",setup(Fe){const{user:g,common:H}=me(),T=ve(),N=m(),U=m(),_=m(!1),h=m([]),f=ge({current_page:1,page_size:30,total:0}),V=m();function Q(e){V.value&&V.value.open([],"dataset",e.id)}const x=m(""),b=m([]),y=m("all");function J(){H.asyncGetValid(De.Dataset,Se.Dataset,_).then(async e=>{e!=null&&e.data?N.value.open():(e==null?void 0:e.code)===400&&Z(r("common.tip"),r("views.dataset.tip.professionalMessage"),{cancelButtonText:r("common.confirm"),confirmButtonText:r("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")}).catch(()=>{})})}function K(){C(r("views.dataset.tip.syncSuccess"))}function O(e){$.putReEmbeddingDataset(e.id).then(()=>{C(r("common.submitSuccess"))})}function P(e){U.value.open(e.id)}function E(){g.userInfo&&localStorage.setItem(g.userInfo.id+"dataset",y.value),f.current_page=1,h.value=[],z()}const j=e=>{$.exportDataset(e.name,e.id,_).then(a=>{C(r("common.exportSuccess"))})},X=e=>{$.exportZipDataset(e.name,e.id,_).then(a=>{C(r("common.exportSuccess"))})};function Y(e){Z(`${r("views.dataset.delete.confirmTitle")}${e.name} ?`,`${r("views.dataset.delete.confirmMessage1")} ${e.application_mapping_count} ${r("views.dataset.delete.confirmMessage2")}`,{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{$.delDataset(e.id,_).then(()=>{const a=h.value.findIndex(u=>u.id===e.id);h.value.splice(a,1),C(r("common.deleteSuccess"))})}).catch(()=>{})}function z(){const e={...x.value&&{name:x.value},...y.value&&y.value!=="all"&&{select_user_id:y.value}};$.getDataset(f,e,_).then(a=>{a.data.records.forEach(u=>{var D;g.userInfo&&u.user_id===g.userInfo.id?u.username=g.userInfo.username:u.username=(D=b.value.find(A=>A.value===u.user_id))==null?void 0:D.label}),f.total=a.data.total,h.value=[...h.value,...a.data.records]})}function ee(){Ie.getUserList("DATASET",_).then(e=>{if(e.data){if(b.value=e.data.map(a=>({label:a.username,value:a.id})),g.userInfo){const a=localStorage.getItem(g.userInfo.id+"dataset");a&&b.value.find(u=>u.value===a)&&(y.value=a)}z()}})}return he(()=>{ee()}),(e,a)=>{const u=s("el-option"),D=s("el-select"),A=s("el-input"),te=s("CardAdd"),q=s("el-col"),R=s("AppAvatar"),ae=s("auto-tooltip"),ne=s("el-text"),S=s("el-tag"),L=s("el-divider"),oe=s("MoreFilled"),se=s("el-icon"),le=s("el-button"),k=s("el-dropdown-item"),B=s("AppIcon"),ce=s("el-dropdown-menu"),ie=s("el-dropdown"),de=s("CardBox"),re=s("el-row"),ue=s("InfiniteScroll"),pe=ye("loading");return i(),I("div",Re,[d("div",Be,[d("h4",null,l(e.$t("views.dataset.title")),1),d("div",Me,[o(D,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),class:"mr-12",onChange:E,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(i(!0),I(F,null,G(b.value,t=>(i(),p(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(A,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=t=>x.value=t),onChange:E,placeholder:e.$t("views.dataset.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"max-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),ke((i(),I("div",null,[o(ue,{size:h.value.length,total:f.total,page_size:f.page_size,current_page:f.current_page,"onUpdate:current_page":a[4]||(a[4]=t=>f.current_page=t),onLoad:z,loading:_.value},{default:n(()=>[o(re,{gutter:15},{default:n(()=>[o(q,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(te,{title:e.$t("views.dataset.createDataset"),onClick:J},null,8,["title"])]),_:1}),(i(!0),I(F,null,G(h.value,(t,_e)=>(i(),p(q,{key:_e,xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(de,{title:t.name,description:t.desc,class:"cursor",onClick:w=>M(T).push({path:`/dataset/${t.id}/document`})},{icon:n(()=>[t.type==="1"?(i(),p(R,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:n(()=>a[5]||(a[5]=[d("img",{src:we,style:{width:"58%"},alt:""},null,-1)])),_:1})):t.type==="2"?(i(),p(R,{key:1,class:"mr-8 avatar-purple",shape:"square",size:32,style:{background:"none"}},{default:n(()=>a[6]||(a[6]=[d("img",{src:Ce,style:{width:"100%"},alt:""},null,-1)])),_:1})):(i(),p(R,{key:2,class:"mr-8 avatar-blue",shape:"square",size:32},{default:n(()=>a[7]||(a[7]=[d("img",{src:$e,style:{width:"58%"},alt:""},null,-1)])),_:1}))]),subTitle:n(()=>[o(ne,{class:"color-secondary",size:"small"},{default:n(()=>[o(ae,{content:t.username},{default:n(()=>[c(l(e.$t("common.creator"))+": "+l(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[d("div",Ne,[d("div",null,[d("span",Ue,l((t==null?void 0:t.document_count)||0),1),c(" "+l(e.$t("views.dataset.document_count")),1),o(L,{direction:"vertical"}),d("span",Ee,l(M(xe)(t==null?void 0:t.char_length)||0),1),c(" "+l(e.$t("common.character")),1),o(L,{direction:"vertical"}),d("span",qe,l((t==null?void 0:t.application_mapping_count)||0),1),c(" "+l(e.$t("views.dataset.relatedApp_count")),1)]),d("div",{onClick:a[3]||(a[3]=v(()=>{},["stop"]))},[o(ie,{trigger:"click"},{dropdown:n(()=>[o(ce,null,{default:n(()=>[t.type==="1"?(i(),p(k,{key:0,icon:"Refresh",onClick:v(w=>P(t),["stop"])},{default:n(()=>[c(l(e.$t("views.dataset.setting.sync")),1)]),_:2},1032,["onClick"])):W("",!0),o(k,{onClick:w=>O(t)},{default:n(()=>[o(B,{iconName:"app-document-refresh",style:{"font-size":"16px"}}),c(" "+l(e.$t("views.dataset.setting.vectorization")),1)]),_:2},1032,["onClick"]),o(k,{icon:"Connection",onClick:v(w=>Q(t),["stop"])},{default:n(()=>[c(l(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"]),o(k,{icon:"Setting",onClick:v(w=>M(T).push({path:`/dataset/${t.id}/setting`}),["stop"])},{default:n(()=>[c(l(e.$t("common.setting")),1)]),_:2},1032,["onClick"]),o(k,{onClick:v(w=>j(t),["stop"])},{default:n(()=>[o(B,{iconName:"app-export"}),c(l(e.$t("views.document.setting.export"))+" Excel",1)]),_:2},1032,["onClick"]),o(k,{onClick:v(w=>X(t),["stop"])},{default:n(()=>[o(B,{iconName:"app-export"}),c(l(e.$t("views.document.setting.export"))+" ZIP",1)]),_:2},1032,["onClick"]),o(k,{icon:"Delete",onClick:v(w=>Y(t),["stop"])},{default:n(()=>[c(l(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(le,{text:"",onClick:a[2]||(a[2]=v(()=>{},["stop"]))},{default:n(()=>[o(se,null,{default:n(()=>[o(oe)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[d("div",Te,[t.type==="0"?(i(),p(S,{key:0,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[c(l(e.$t("views.dataset.general")),1)]),_:1})):t.type==="1"?(i(),p(S,{key:1,class:"purple-tag",type:"warning",style:{height:"22px"}},{default:n(()=>[c(l(e.$t("views.dataset.web")),1)]),_:1})):t.type==="2"?(i(),p(S,{key:2,class:"purple-tag",type:"warning",style:{height:"22px"}},{default:n(()=>[c(l(e.$t("views.dataset.lark")),1)]),_:1})):t.type==="3"?(i(),p(S,{key:3,class:"purple-tag",type:"warning",style:{height:"22px"}},{default:n(()=>[c(l(e.$t("views.dataset.yuque")),1)]),_:1})):W("",!0)])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[pe,f.current_page===1&&_.value,void 0,{fullscreen:!0,lock:!0}]]),o(ze,{ref_key:"SyncWebDialogRef",ref:U,onRefresh:K},null,512),o(be,{ref_key:"CreateDatasetDialogRef",ref:N},null,512),o(Ae,{ref_key:"GenerateRelatedDialogRef",ref:V},null,512)])}}});const He=Ve(Le,[["__scopeId","data-v-6d3de3e4"]]);export{He as default};
